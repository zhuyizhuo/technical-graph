# ğŸ“‹ APIè®¾è®¡

## ä¸€ã€APIè®¾è®¡æ¦‚è¿°

APIï¼ˆApplication Programming Interfaceï¼‰æ˜¯åº”ç”¨ç¨‹åºæ¥å£çš„ç®€ç§°ï¼Œå®ƒå®šä¹‰äº†è½¯ä»¶ç»„ä»¶ä¹‹é—´çš„äº¤äº’æ–¹å¼ã€‚è‰¯å¥½çš„APIè®¾è®¡æ˜¯æ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•ç³»ç»Ÿçš„åŸºç¡€ï¼Œå°¤å…¶åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒAPIè®¾è®¡çš„è´¨é‡ç›´æ¥å½±å“åˆ°ç³»ç»Ÿçš„æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

### 1.1 APIè®¾è®¡çš„é‡è¦æ€§

- **ç®€åŒ–é›†æˆ**ï¼šè‰¯å¥½çš„APIè®¾è®¡å¯ä»¥ç®€åŒ–ç³»ç»Ÿé›†æˆè¿‡ç¨‹ï¼Œé™ä½é›†æˆæˆæœ¬
- **æé«˜å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„APIè®¾è®¡å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œä¾¿äºå›¢é˜Ÿåä½œ
- **ä¿ƒè¿›å¤ç”¨**ï¼šæ ‡å‡†åŒ–çš„APIè®¾è®¡å¯ä»¥ä¿ƒè¿›ä»£ç å’ŒåŠŸèƒ½çš„å¤ç”¨
- **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šå¯¹äºå¤–éƒ¨APIï¼Œè‰¯å¥½çš„è®¾è®¡å¯ä»¥æå‡å¼€å‘è€…çš„ä½¿ç”¨ä½“éªŒ
- **æ”¯æŒæ¼”è¿›**ï¼šè‰¯å¥½çš„APIè®¾è®¡å¯ä»¥æ”¯æŒç³»ç»Ÿçš„æŒç»­æ¼”è¿›ï¼Œé¿å…ç ´åæ€§å˜æ›´
- **é™ä½é£é™©**ï¼šæ ‡å‡†åŒ–çš„APIè®¾è®¡å¯ä»¥é™ä½ç³»ç»Ÿçš„å¤æ‚æ€§å’Œé£é™©

### 1.2 APIçš„ç±»å‹

æ ¹æ®ä¸åŒçš„åˆ†ç±»æ ‡å‡†ï¼ŒAPIå¯ä»¥åˆ†ä¸ºå¤šç§ç±»å‹ï¼š

#### 1.2.1 æŒ‰è®¿é—®æ–¹å¼åˆ†ç±»

- **å…¬å¼€API**ï¼šå¯¹å¤–éƒ¨å¼€å‘è€…å¼€æ”¾çš„APIï¼Œé€šå¸¸éœ€è¦è®¤è¯å’Œæˆæƒ
- **å†…éƒ¨API**ï¼šç»„ç»‡å†…éƒ¨ä½¿ç”¨çš„APIï¼Œé€šå¸¸ç”¨äºå¾®æœåŠ¡é—´é€šä¿¡
- **åˆä½œä¼™ä¼´API**ï¼šä¸ºç‰¹å®šåˆä½œä¼™ä¼´æä¾›çš„APIï¼Œé€šå¸¸æœ‰ç‰¹æ®Šçš„è®¿é—®æ§åˆ¶

#### 1.2.2 æŒ‰é€šä¿¡åè®®åˆ†ç±»

- **REST API**ï¼šåŸºäºHTTPåè®®çš„RESTful API
- **GraphQL API**ï¼šåŸºäºGraphQLæŸ¥è¯¢è¯­è¨€çš„API
- **gRPC API**ï¼šåŸºäºgRPCæ¡†æ¶çš„é«˜æ€§èƒ½API
- **WebSocket API**ï¼šæ”¯æŒåŒå‘é€šä¿¡çš„WebSocket API
- **SOAP API**ï¼šåŸºäºSOAPåè®®çš„ä¼ ç»ŸWebæœåŠ¡API

#### 1.2.3 æŒ‰åŠŸèƒ½åˆ†ç±»

- **ä¸šåŠ¡API**ï¼šæä¾›ä¸šåŠ¡åŠŸèƒ½çš„API
- **æ•°æ®API**ï¼šæä¾›æ•°æ®è®¿é—®åŠŸèƒ½çš„API
- **ç³»ç»ŸAPI**ï¼šæä¾›ç³»ç»Ÿçº§åŠŸèƒ½çš„APIï¼ˆå¦‚è®¤è¯ã€æ—¥å¿—ç­‰ï¼‰
- **é›†æˆAPI**ï¼šç”¨äºç³»ç»Ÿé›†æˆçš„API

### 1.3 APIè®¾è®¡çš„æ ¸å¿ƒåŸåˆ™

- **ç®€æ´æ€§**ï¼šAPIåº”è¯¥ç®€æ´æ˜äº†ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨
- **ä¸€è‡´æ€§**ï¼šAPIçš„å‘½åã€æ ¼å¼ã€å‚æ•°ç­‰åº”è¯¥ä¿æŒä¸€è‡´
- **å¯ç”¨æ€§**ï¼šAPIåº”è¯¥ç¨³å®šå¯é ï¼Œå…·æœ‰è‰¯å¥½çš„å¯ç”¨æ€§
- **å®‰å…¨æ€§**ï¼šAPIåº”è¯¥å…·æœ‰å®Œå–„çš„å®‰å…¨æœºåˆ¶ï¼Œä¿æŠ¤æ•°æ®å’Œç³»ç»Ÿå®‰å…¨
- **å¯æ‰©å±•æ€§**ï¼šAPIåº”è¯¥å…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œæ”¯æŒæœªæ¥çš„åŠŸèƒ½æ‰©å±•
- **å‘åå…¼å®¹æ€§**ï¼šAPIçš„å˜æ›´åº”è¯¥ä¿æŒå‘åå…¼å®¹ï¼Œé¿å…å½±å“ç°æœ‰ç”¨æˆ·
- **æ–‡æ¡£åŒ–**ï¼šAPIåº”è¯¥æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼Œä¾¿äºå¼€å‘è€…ä½¿ç”¨å’Œç†è§£

## äºŒã€RESTful APIè®¾è®¡

RESTï¼ˆRepresentational State Transferï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„çº¦æŸæ¡ä»¶å’ŒåŸåˆ™ï¼Œç”¨äºåˆ›å»ºWebæœåŠ¡ã€‚RESTful APIæ˜¯ç¬¦åˆRESTæ¶æ„é£æ ¼çš„APIã€‚

### 2.1 RESTful APIçš„æ ¸å¿ƒåŸåˆ™

- **èµ„æºå¯¼å‘**ï¼šå°†ç³»ç»Ÿä¸­çš„å®ä½“æŠ½è±¡ä¸ºèµ„æºï¼Œæ¯ä¸ªèµ„æºéƒ½æœ‰å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆURIï¼‰
- **æ— çŠ¶æ€**ï¼šæœåŠ¡å™¨ä¸ä¿å­˜å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«å®Œæ•´çš„ä¿¡æ¯
- **ç»Ÿä¸€æ¥å£**ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ¥å£è¿›è¡Œèµ„æºæ“ä½œï¼ŒåŒ…æ‹¬GETã€POSTã€PUTã€DELETEç­‰HTTPæ–¹æ³•
- **è¡¨ç°å±‚**ï¼šèµ„æºçš„è¡¨ç°å½¢å¼ä¸èµ„æºæœ¬èº«åˆ†ç¦»ï¼Œå¯ä»¥æœ‰å¤šç§è¡¨ç°å½¢å¼ï¼ˆå¦‚JSONã€XMLç­‰ï¼‰
- **è¶…åª’ä½“é©±åŠ¨**ï¼šAPIåº”è¯¥åŒ…å«è¶…åª’ä½“é“¾æ¥ï¼Œå¼•å¯¼å®¢æˆ·ç«¯å‘ç°å’Œä½¿ç”¨ç›¸å…³èµ„æº
- **åˆ†å±‚ç³»ç»Ÿ**ï¼šä½¿ç”¨åˆ†å±‚æ¶æ„ï¼Œæ¯å±‚åªä¸ç›¸é‚»å±‚äº¤äº’

### 2.2 èµ„æºè®¾è®¡

èµ„æºæ˜¯RESTful APIçš„æ ¸å¿ƒæ¦‚å¿µï¼Œåˆç†çš„èµ„æºè®¾è®¡æ˜¯åˆ›å»ºé«˜è´¨é‡APIçš„åŸºç¡€ã€‚

#### 2.2.1 èµ„æºè¯†åˆ«

è¯†åˆ«ç³»ç»Ÿä¸­çš„å…³é”®å®ä½“å’Œæ¦‚å¿µï¼Œå°†å…¶æŠ½è±¡ä¸ºèµ„æºã€‚ä¾‹å¦‚ï¼Œåœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œå¸¸è§çš„èµ„æºåŒ…æ‹¬ï¼šç”¨æˆ·ï¼ˆUserï¼‰ã€å•†å“ï¼ˆProductï¼‰ã€è®¢å•ï¼ˆOrderï¼‰ã€è´­ç‰©è½¦ï¼ˆCartï¼‰ç­‰ã€‚

#### 2.2.2 èµ„æºå‘½å

èµ„æºå‘½ååº”è¯¥éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

- **ä½¿ç”¨åè¯**ï¼šèµ„æºåç§°åº”è¯¥ä½¿ç”¨åè¯ï¼Œè€Œä¸æ˜¯åŠ¨è¯
- **ä½¿ç”¨å¤æ•°å½¢å¼**ï¼šèµ„æºé›†åˆåº”è¯¥ä½¿ç”¨å¤æ•°å½¢å¼ï¼ˆå¦‚/productsï¼‰
- **ä½¿ç”¨å°å†™å­—æ¯**ï¼šèµ„æºåç§°åº”è¯¥ä½¿ç”¨å°å†™å­—æ¯
- **ä½¿ç”¨è¿å­—ç¬¦**ï¼šå¤šä¸ªå•è¯ç»„æˆçš„èµ„æºåç§°åº”è¯¥ä½¿ç”¨è¿å­—ç¬¦ï¼ˆ-ï¼‰åˆ†éš”ï¼Œè€Œä¸æ˜¯ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰æˆ–é©¼å³°å¼å‘½å
- **ä¿æŒç®€æ´**ï¼šèµ„æºåç§°åº”è¯¥ç®€æ´æ˜äº†ï¼Œé¿å…ä½¿ç”¨å¤æ‚æˆ–æ¨¡ç³Šçš„æœ¯è¯­

**ç¤ºä¾‹**ï¼š

| èµ„æº | URI | è¯´æ˜ |
|------|-----|------|
| ç”¨æˆ·é›†åˆ | /users | ç”¨æˆ·èµ„æºçš„é›†åˆ |
| å•ä¸ªç”¨æˆ· | /users/{id} | ç‰¹å®šIDçš„ç”¨æˆ·èµ„æº |
| ç”¨æˆ·çš„è®¢å• | /users/{id}/orders | ç‰¹å®šç”¨æˆ·çš„è®¢å•é›†åˆ |
| å•†å“é›†åˆ | /products | å•†å“èµ„æºçš„é›†åˆ |
| å•ä¸ªå•†å“ | /products/{id} | ç‰¹å®šIDçš„å•†å“èµ„æº |
| è®¢å•é›†åˆ | /orders | è®¢å•èµ„æºçš„é›†åˆ |
| å•ä¸ªè®¢å• | /orders/{id} | ç‰¹å®šIDçš„è®¢å•èµ„æº |
| è®¢å•ä¸­çš„å•†å“ | /orders/{id}/items | ç‰¹å®šè®¢å•ä¸­çš„å•†å“é¡¹é›†åˆ |

#### 2.2.3 èµ„æºå…³ç³»

å®šä¹‰èµ„æºä¹‹é—´çš„å…³ç³»ï¼Œå¸¸è§çš„å…³ç³»åŒ…æ‹¬ï¼š

- **ä¸€å¯¹ä¸€**ï¼šä¸€ä¸ªèµ„æºä¸å¦ä¸€ä¸ªèµ„æºå­˜åœ¨ä¸€å¯¹ä¸€çš„å…³ç³»
- **ä¸€å¯¹å¤š**ï¼šä¸€ä¸ªèµ„æºä¸å¤šä¸ªèµ„æºå­˜åœ¨ä¸€å¯¹å¤šçš„å…³ç³»
- **å¤šå¯¹å¤š**ï¼šå¤šä¸ªèµ„æºä¸å¤šä¸ªèµ„æºå­˜åœ¨å¤šå¯¹å¤šçš„å…³ç³»

**è¡¨ç¤ºæ–¹æ³•**ï¼š

- **åµŒå¥—URI**ï¼šä½¿ç”¨åµŒå¥—URIè¡¨ç¤ºèµ„æºä¹‹é—´çš„å…³ç³»ï¼Œå¦‚/users/{id}/ordersè¡¨ç¤ºç”¨æˆ·çš„è®¢å•
- **é“¾æ¥**ï¼šåœ¨èµ„æºçš„è¡¨ç¤ºä¸­åŒ…å«æŒ‡å‘ç›¸å…³èµ„æºçš„é“¾æ¥

### 2.3 HTTPæ–¹æ³•çš„ä½¿ç”¨

RESTful APIä½¿ç”¨HTTPæ–¹æ³•æ¥è¡¨ç¤ºå¯¹èµ„æºçš„æ“ä½œï¼Œå¸¸è§çš„HTTPæ–¹æ³•åŠå…¶ç”¨é€”å¦‚ä¸‹ï¼š

| HTTPæ–¹æ³• | ç”¨é€” | å¹‚ç­‰æ€§ | å®‰å…¨æ€§ |
|----------|------|--------|--------|
| GET | è·å–èµ„æº | æ˜¯ | æ˜¯ |
| POST | åˆ›å»ºèµ„æº | å¦ | å¦ |
| PUT | æ›´æ–°èµ„æºï¼ˆå…¨éƒ¨ï¼‰ | æ˜¯ | å¦ |
| PATCH | æ›´æ–°èµ„æºï¼ˆéƒ¨åˆ†ï¼‰ | å¦ | å¦ |
| DELETE | åˆ é™¤èµ„æº | æ˜¯ | å¦ |
| HEAD | è·å–èµ„æºçš„å…ƒæ•°æ® | æ˜¯ | æ˜¯ |
| OPTIONS | è·å–èµ„æºæ”¯æŒçš„æ“ä½œ | æ˜¯ | æ˜¯ |

**è¯´æ˜**ï¼š
- **å¹‚ç­‰æ€§**ï¼šå¤šæ¬¡æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç»“æœç›¸åŒ
- **å®‰å…¨æ€§**ï¼šæ“ä½œä¸ä¼šä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„èµ„æº

#### 2.3.1 GETæ–¹æ³•

GETæ–¹æ³•ç”¨äºè·å–èµ„æºï¼Œåº”è¯¥æ˜¯å®‰å…¨å’Œå¹‚ç­‰çš„ã€‚

**ç¤ºä¾‹**ï¼š

```

#### 3.6.2 åµŒå¥—Resolver

åµŒå¥—Resolverç”¨äºè§£æåµŒå¥—å­—æ®µçš„å€¼ï¼Œç‰¹åˆ«æ˜¯å½“éœ€è¦ä»å…¶ä»–æ•°æ®æºè·å–å…³è”æ•°æ®æ—¶ã€‚

**ç¤ºä¾‹ï¼ˆJava + Spring for GraphQLï¼‰**ï¼š

```java
@Controller
public class UserController {
    @Autowired
    private UserService userService;
    
    @Autowired
    private OrderService orderService;
    
    // æŸ¥è¯¢å•ä¸ªç”¨æˆ·
    @QueryMapping
    public User user(@Argument Long id) {
        return userService.findById(id)
                .orElseThrow(() -> new UserNotFoundException("User not found with id: " + id));
    }

    @PostMapping
    @ApiOperation("Create a new user")
    @ApiResponses(value = {
            @ApiResponse(code = 201, message = "Successfully created user"),
            @ApiResponse(code = 400, message = "Invalid input"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden")
    })
    public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
        User createdUser = userService.createUser(user);
        return new ResponseEntity<>(createdUser, HttpStatus.CREATED);
    }

    @PutMapping("/{id}")
    @ApiOperation("Update a user")
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = "Successfully updated user"),
            @ApiResponse(code = 400, message = "Invalid input"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden"),
            @ApiResponse(code = 404, message = "User not found")
    })
    public ResponseEntity<User> updateUser(@PathVariable Long id, @Valid @RequestBody User user) {
        User updatedUser = userService.updateUser(id, user);
        return ResponseEntity.ok(updatedUser);
    }

    @DeleteMapping("/{id}")
    @ApiOperation("Delete a user")
    @ApiResponses(value = {
            @ApiResponse(code = 204, message = "Successfully deleted user"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden"),
            @ApiResponse(code = 404, message = "User not found")
    })
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
        return ResponseEntity.noContent().build();
    }
}



    @PostMapping
    @ApiOperation("Create a new user")
    @ApiResponses(value = {
            @ApiResponse(code = 201, message = "Successfully created user"),
            @ApiResponse(code = 400, message = "Invalid input"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden")
    })
    public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
        User createdUser = userService.createUser(user);
        return new ResponseEntity<>(createdUser, HttpStatus.CREATED);
    }

    @PutMapping("/{id}")
    @ApiOperation("Update a user")
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = "Successfully updated user"),
            @ApiResponse(code = 400, message = "Invalid input"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden"),
            @ApiResponse(code = 404, message = "User not found")
    })
    public ResponseEntity<User> updateUser(@PathVariable Long id, @Valid @RequestBody User user) {
        User updatedUser = userService.updateUser(id, user);
        return ResponseEntity.ok(updatedUser);
    }

    @DeleteMapping("/{id}")
    @ApiOperation("Delete a user")
    @ApiResponses(value = {
            @ApiResponse(code = 204, message = "Successfully deleted user"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden"),
            @ApiResponse(code = 404, message = "User not found")
    })
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
        return ResponseEntity.noContent().build();
    }
}
    
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    @QueryMapping
    public List<User> users(
            @Argument Integer page,
            @Argument Integer size,
            @Argument String sort) {
        Pageable pageable = PageRequest.of(
                page != null ? page - 1 : 0,
                size != null ? size : 10,
                Sort.by(getSortDirection(sort)));
        return userService.findAll(pageable).getContent();
    }
    
    // è§£æç”¨æˆ·çš„è®¢å•
    @SchemaMapping(typeName = "User", field = "orders")
    public List<Order> orders(User user) {
        return orderService.findByUserId(user.getId());
    }
    
    private Sort.Direction getSortDirection(String sort) {
        if (sort == null || sort.isEmpty()) {
            return Sort.Direction.ASC;
        }
        if (sort.endsWith("_DESC")) {
            return Sort.Direction.DESC;
        }
        return Sort.Direction.ASC;
    }
}

@Controller
public class OrderController {
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private ProductService productService;
    
    // æŸ¥è¯¢å•ä¸ªè®¢å•
    @QueryMapping
    public Order order(@Argument Long id) {
        return orderService.findById(id)
                .orElseThrow(() -> new OrderNotFoundException("Order not found with id: " + id));
    }
    
    // æŸ¥è¯¢æ‰€æœ‰è®¢å•
    @QueryMapping
    public List<Order> orders(
            @Argument Integer page,
            @Argument Integer size,
            @Argument String sort,
            @Argument OrderStatus status,
            @Argument Long userId) {
        Pageable pageable = PageRequest.of(
                page != null ? page - 1 : 0,
                size != null ? size : 10,
                Sort.by(getSortDirection(sort)));
        return orderService.findOrders(pageable, status, userId).getContent();
    }
    
    // åˆ›å»ºè®¢å•
    @MutationMapping
    public Order createOrder(@Argument CreateOrderInput input) {
        return orderService.createOrder(input);
    }
    
    // æ›´æ–°è®¢å•çŠ¶æ€
    @MutationMapping
    public Order updateOrderStatus(@Argument Long id, @Argument OrderStatus status) {
        return orderService.updateOrderStatus(id, status);
    }
    
    // åˆ é™¤è®¢å•
    @MutationMapping
    public boolean deleteOrder(@Argument Long id) {
        orderService.deleteById(id);
        return true;
    }
    
    // è§£æè®¢å•çš„ç”¨æˆ·
    @SchemaMapping(typeName = "Order", field = "user")
    public User user(Order order) {
        return userService.findById(order.getUserId())
                .orElseThrow(() -> new UserNotFoundException("User not found with id: " + order.getUserId()));
    }
    
    // è§£æè®¢å•çš„å•†å“é¡¹
    @SchemaMapping(typeName = "Order", field = "items")
    public List<OrderItem> items(Order order) {
        return order.getItems();
    }
    
    // è§£æè®¢å•é¡¹çš„å•†å“
    @SchemaMapping(typeName = "OrderItem", field = "product")
    public Product product(OrderItem orderItem) {
        return productService.findById(orderItem.getProductId())
                .orElseThrow(() -> new ProductNotFoundException("Product not found with id: " + orderItem.getProductId()));
    }
    
    private Sort.Direction getSortDirection(String sort) {
        if (sort == null || sort.isEmpty()) {
            return Sort.Direction.ASC;
        }
        if (sort.endsWith("_DESC")) {
            return Sort.Direction.DESC;
        }
        return Sort.Direction.ASC;
    }
}

@Controller
public class ProductController {
    @Autowired
    private ProductService productService;
    
    // æŸ¥è¯¢å•ä¸ªå•†å“
    @QueryMapping
    public Product product(@Argument Long id) {
        return productService.findById(id)
                .orElseThrow(() -> new ProductNotFoundException("Product not found with id: " + id));
    }
    
    // æŸ¥è¯¢æ‰€æœ‰å•†å“
    @QueryMapping
    public List<Product> products(
            @Argument Integer page,
            @Argument Integer size,
            @Argument String sort,
            @Argument String category,
            @Argument Double priceGte,
            @Argument Double priceLte) {
        Pageable pageable = PageRequest.of(
                page != null ? page - 1 : 0,
                size != null ? size : 10,
                Sort.by(getSortDirection(sort)));
        return productService.findProducts(pageable, category, priceGte, priceLte).getContent();
    }
    
    private Sort.Direction getSortDirection(String sort) {
        if (sort == null || sort.isEmpty()) {
            return Sort.Direction.ASC;
        }
        if (sort.endsWith("_DESC")) {
            return Sort.Direction.DESC;
        }
        return Sort.Direction.ASC;
    }
}

// è®¢é˜…ç›¸å…³é…ç½®
@Configuration
public class SubscriptionConfig {
    @Bean
    public ExecutorSubscriptionRegistry subscriptionRegistry() {
        return new ExecutorSubscriptionRegistry();
    }
    
    @Bean
    public Publisher<Order> orderCreatedPublisher() {
        return new SimplePublisher<>();
    }
    
    @Bean
    public Publisher<Order> orderStatusUpdatedPublisher() {
        return new SimplePublisher<>();
    }
}

@Controller
public class SubscriptionController {
    @Autowired
    private Publisher<Order> orderCreatedPublisher;
    
    @Autowired
    private Publisher<Order> orderStatusUpdatedPublisher;
    
    // è®¢é˜…è®¢å•åˆ›å»ºäº‹ä»¶
    @SubscriptionMapping("orderCreated")
    public Publisher<Order> orderCreated() {
        return orderCreatedPublisher;
    }
    
    // è®¢é˜…è®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
    @SubscriptionMapping("orderStatusUpdated")
    public Publisher<Order> orderStatusUpdated() {
        return orderStatusUpdatedPublisher;
    }
}
```

### 3.7 GraphQL APIçš„å®‰å…¨è®¾è®¡

GraphQL APIçš„å®‰å…¨è®¾è®¡ä¸REST APIç±»ä¼¼ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šçš„è€ƒè™‘å› ç´ ï¼š

- **è®¤è¯å’Œæˆæƒ**ï¼šä½¿ç”¨OAuth 2.0ã€JWTç­‰æœºåˆ¶è¿›è¡Œè®¤è¯å’Œæˆæƒ
- **æŸ¥è¯¢å¤æ‚åº¦æ§åˆ¶**ï¼šé™åˆ¶æŸ¥è¯¢çš„å¤æ‚åº¦ï¼Œé˜²æ­¢æ¶æ„æŸ¥è¯¢è€—å°½æœåŠ¡å™¨èµ„æº
- **æŸ¥è¯¢æ·±åº¦æ§åˆ¶**ï¼šé™åˆ¶æŸ¥è¯¢çš„åµŒå¥—æ·±åº¦ï¼Œé˜²æ­¢æ— é™é€’å½’æŸ¥è¯¢
- **å­—æ®µçº§æƒé™æ§åˆ¶**ï¼šå¯¹ä¸åŒç”¨æˆ·æˆäºˆä¸åŒå­—æ®µçš„è®¿é—®æƒé™
- **æ‰¹é‡æ“ä½œé™åˆ¶**ï¼šé™åˆ¶æ‰¹é‡æ“ä½œçš„æ•°é‡ï¼Œé˜²æ­¢DoSæ”»å‡»
- **è¾“å…¥éªŒè¯**ï¼šéªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°ï¼Œé˜²æ­¢æ³¨å…¥æ”»å‡»
- **HTTPS**ï¼šä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“æ•°æ®

**ç¤ºä¾‹ï¼ˆæŸ¥è¯¢å¤æ‚åº¦æ§åˆ¶ï¼‰**ï¼š

```javascript
const { ApolloServer, gql, makeExecutableSchema } = require('apollo-server');
const { createComplexityLimitRule } = require('graphql-validation-complexity');

// å®šä¹‰Schema
const typeDefs = gql`
  type User {
    id: ID!
    name: String!
    email: String!
    orders: [Order!]!
  }
  
  type Order {
    id: ID!
    totalAmount: Float!
    items: [OrderItem!]!
  }
  
  type OrderItem {
    id: ID!
    quantity: Int!
    product: Product!
  }
  
  type Product {
    id: ID!
    name: String!
    price: Float!
  }
  
  type Query {
    user(id: ID!): User
    users: [User!]!
  }
`;

// å®šä¹‰Resolver
const resolvers = {
  Query: {
    user: (parent, args) => { /* å®ç° */ },
    users: (parent, args) => { /* å®ç° */ },
  },
  User: { orders: (parent) => { /* å®ç° */ } },
  Order: { items: (parent) => { /* å®ç° */ } },
  OrderItem: { product: (parent) => { /* å®ç° */ } },
};

// åˆ›å»ºSchema
const schema = makeExecutableSchema({ typeDefs, resolvers });

// åˆ›å»ºæŸ¥è¯¢å¤æ‚åº¦é™åˆ¶è§„åˆ™
const complexityLimitRule = createComplexityLimitRule(1000, {
  onCost: cost => console.log('Query cost:', cost),
  createError: (max, actual) => 
    new Error(`Query is too complex: ${actual}. Maximum allowed complexity: ${max}`),
});

// åˆ›å»ºApollo Server
const server = new ApolloServer({
  schema,
  validationRules: [complexityLimitRule],
  context: ({ req }) => {
    // è®¤è¯é€»è¾‘
    const token = req.headers.authorization || '';
    const user = authenticateUser(token);
    return { user };
  },
});

// å¯åŠ¨æœåŠ¡å™¨
server.listen().then(({ url }) => {
  console.log(`ğŸš€ Server ready at ${url}`);
});
```

## å››ã€APIç½‘å…³è®¾è®¡

APIç½‘å…³æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„é‡è¦ç»„ä»¶ï¼Œå®ƒä½œä¸ºç³»ç»Ÿçš„å”¯ä¸€å…¥å£ï¼Œè´Ÿè´£è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯æˆæƒã€é™æµç†”æ–­ç­‰åŠŸèƒ½ã€‚

### 4.1 APIç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½

- **è¯·æ±‚è·¯ç”±**ï¼šæ ¹æ®è¯·æ±‚è·¯å¾„å°†è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡
- **è´Ÿè½½å‡è¡¡**ï¼šåœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡
- **è®¤è¯æˆæƒ**ï¼šå¯¹è¯·æ±‚è¿›è¡Œè®¤è¯å’Œæˆæƒæ£€æŸ¥
- **é™æµç†”æ–­**ï¼šå¯¹è¯·æ±‚è¿›è¡Œé™æµå’Œç†”æ–­å¤„ç†
- **ç›‘æ§æ—¥å¿—**ï¼šæ”¶é›†è¯·æ±‚çš„ç›‘æ§å’Œæ—¥å¿—ä¿¡æ¯
- **åè®®è½¬æ¢**ï¼šåœ¨ä¸åŒåè®®ä¹‹é—´è¿›è¡Œè½¬æ¢
- **æ•°æ®è½¬æ¢**ï¼šå¯¹è¯·æ±‚å’Œå“åº”æ•°æ®è¿›è¡Œè½¬æ¢
- **ç¼“å­˜**ï¼šå¯¹é¢‘ç¹è¯·æ±‚çš„å“åº”è¿›è¡Œç¼“å­˜
- **APIç»„åˆ**ï¼šå°†å¤šä¸ªAPIçš„å“åº”ç»„åˆæˆä¸€ä¸ªå“åº”
- **å®‰å…¨é˜²æŠ¤**ï¼šé˜²æ­¢å¸¸è§çš„Webæ”»å‡»ï¼Œå¦‚SQLæ³¨å…¥ã€XSSç­‰

### 4.2 APIç½‘å…³çš„æ¶æ„è®¾è®¡

APIç½‘å…³çš„æ¶æ„è®¾è®¡åº”è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

#### 4.2.1 ç»„ä»¶è®¾è®¡

APIç½‘å…³é€šå¸¸ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼š

- **è¯·æ±‚å¤„ç†å™¨**ï¼šæ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚
- **è·¯ç”±ç®¡ç†å™¨**ï¼šç®¡ç†è¯·æ±‚è·¯ç”±è§„åˆ™
- **è¿‡æ»¤å™¨é“¾**ï¼šåŒ…å«å¤šä¸ªè¿‡æ»¤å™¨ï¼Œç”¨äºå®ç°å„ç§åŠŸèƒ½
- **æœåŠ¡å‘ç°å®¢æˆ·ç«¯**ï¼šä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒäº¤äº’ï¼Œè·å–æœåŠ¡å®ä¾‹ä¿¡æ¯
- **è´Ÿè½½å‡è¡¡å™¨**ï¼šåœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡
- **è®¤è¯æˆæƒç®¡ç†å™¨**ï¼šå¤„ç†è®¤è¯å’Œæˆæƒé€»è¾‘
- **é™æµç†”æ–­ç®¡ç†å™¨**ï¼šå¤„ç†é™æµå’Œç†”æ–­é€»è¾‘
- **ç›‘æ§æ—¥å¿—æ”¶é›†å™¨**ï¼šæ”¶é›†ç›‘æ§å’Œæ—¥å¿—ä¿¡æ¯
- **é…ç½®ç®¡ç†å™¨**ï¼šç®¡ç†ç½‘å…³çš„é…ç½®ä¿¡æ¯

#### 4.2.2 æµç¨‹å›¾

```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ APIç½‘å…³ â†’ è¯·æ±‚è§£æ â†’ è·¯ç”±åŒ¹é… â†’ å‰ç½®è¿‡æ»¤å™¨ â†’ æœåŠ¡è°ƒç”¨ â†’ åç½®è¿‡æ»¤å™¨ â†’ å“åº”å¤„ç† â†’ å®¢æˆ·ç«¯
    â†“             â†“           â†“           â†“              â†“           â†“              â†“           â†“
  ç›‘æ§æ—¥å¿—      é…ç½®ç®¡ç†     æœåŠ¡å‘ç°     è®¤è¯æˆæƒ     é™æµç†”æ–­     è´Ÿè½½å‡è¡¡      æ•°æ®è½¬æ¢     ç¼“å­˜ç®¡ç†
```

#### 4.2.3 éƒ¨ç½²æ¨¡å¼

APIç½‘å…³çš„éƒ¨ç½²æ¨¡å¼åŒ…æ‹¬ï¼š

- **å•å®ä¾‹éƒ¨ç½²**ï¼šç®€å•ä½†ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
- **é›†ç¾¤éƒ¨ç½²**ï¼šå¤šå®ä¾‹éƒ¨ç½²ï¼Œæé«˜å¯ç”¨æ€§å’Œæ€§èƒ½
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¾¿äºç®¡ç†å’Œæ‰©å±•
- **äº‘åŸç”Ÿéƒ¨ç½²**ï¼šåœ¨Kubernetesç­‰äº‘åŸç”Ÿå¹³å°ä¸Šéƒ¨ç½²ï¼Œå……åˆ†åˆ©ç”¨äº‘åŸç”Ÿç‰¹æ€§
### 4.3 APIç½‘å…³çš„å®ç°æ–¹æ¡ˆ

APIç½‘å…³çš„å®ç°æ–¹æ¡ˆæœ‰å¤šç§ï¼ŒåŒ…æ‹¬è‡ªç ”å’Œä½¿ç”¨å¼€æºæ¡†æ¶ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„APIç½‘å…³å®ç°æ–¹æ¡ˆï¼š

#### 4.3.1 Spring Cloud Gateway

Spring Cloud Gatewayæ˜¯Spring Cloudç”Ÿæ€ä¸­çš„APIç½‘å…³ç»„ä»¶ï¼Œå®ƒåŸºäºSpring 5ã€Spring Boot 2å’ŒProject Reactoræ„å»ºï¼Œæä¾›äº†è·¯ç”±ã€è¿‡æ»¤ã€é™æµç­‰åŠŸèƒ½ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- åŸºäºå“åº”å¼ç¼–ç¨‹æ¨¡å‹
- æ”¯æŒåŠ¨æ€è·¯ç”±
- æ”¯æŒé™æµç†”æ–­
- æ”¯æŒè·¯å¾„é‡å†™
- æ”¯æŒé›†æˆæœåŠ¡å‘ç°
- æ”¯æŒå„ç§è¿‡æ»¤å™¨

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
          filters:
            - StripPrefix=1
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10
                redis-rate-limiter.burstCapacity: 20
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/api/orders/**
          filters:
            - StripPrefix=1
      default-filters:
        - name: Hystrix
          args:
            name: fallbackCommand
            fallbackUri: forward:/fallback
        - name: GlobalFilter
          args:
            name: logFilter

# é›†æˆæœåŠ¡å‘ç°
eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
```

**ä»£ç ç¤ºä¾‹ï¼ˆè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼‰**ï¼š

```java
@Component
public class AuthenticationFilter implements GlobalFilter, Ordered {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        // ä»è¯·æ±‚å¤´ä¸­è·å–token
        String token = exchange.getRequest().getHeaders().getFirst("Authorization");
        
        // éªŒè¯token
        if (token == null || !token.startsWith("Bearer ")) {
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
        
        // è§£ætokenå¹¶è·å–ç”¨æˆ·ä¿¡æ¯
        String jwt = token.substring(7);
        // TODO: éªŒè¯å’Œè§£æJWT token
        
        // å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­
        ServerHttpRequest request = exchange.getRequest().mutate()
                .header("X-User-Id", "user-123")
                .header("X-User-Role", "admin")
                .build();
        
        // ç»§ç»­æ‰§è¡Œè¿‡æ»¤å™¨é“¾
        return chain.filter(exchange.mutate().request(request).build());
    }

    @Override
    public int getOrder() {
        // è®¾ç½®è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåº
        return -100;
    }
}
```

#### 4.3.2 Netflix Zuul

Netflix Zuulæ˜¯Netflixå¼€æºçš„APIç½‘å…³ç»„ä»¶ï¼Œå®ƒåŸºäºServletå®ç°ï¼Œæä¾›äº†è·¯ç”±ã€è¿‡æ»¤ã€é™æµç­‰åŠŸèƒ½ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- æ”¯æŒåŠ¨æ€è·¯ç”±
- æ”¯æŒè¿‡æ»¤
- æ”¯æŒæœåŠ¡å‘ç°
- æ”¯æŒç†”æ–­
- æ”¯æŒç›‘æ§

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
zuul:
  routes:
    user-service:
      path: /api/users/**
      serviceId: user-service
      stripPrefix: true
    order-service:
      path: /api/orders/**
      serviceId: order-service
      stripPrefix: true
  ratelimit:
    enabled: true
    repository: REDIS
    policies:
      user-service:
        limit: 10
        quota: 1000
        refresh-interval: 60
  ignored-headers:
    - Set-Cookie

# é›†æˆæœåŠ¡å‘ç°
eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
```

**ä»£ç ç¤ºä¾‹ï¼ˆè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼‰**ï¼š

```java
@Component
public class LoggingFilter extends ZuulFilter {

    private static final Logger logger = LoggerFactory.getLogger(LoggingFilter.class);

    @Override
    public String filterType() {
        // pre: è¯·æ±‚å‰æ‰§è¡Œ
        // route: è·¯ç”±è¯·æ±‚æ—¶æ‰§è¡Œ
        // post: è¯·æ±‚åæ‰§è¡Œ
        // error: å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œ
        return "pre";
    }

    @Override
    public int filterOrder() {
        // è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåº
        return 1;
    }

    @Override
    public boolean shouldFilter() {
        // æ˜¯å¦å¯ç”¨è¿‡æ»¤å™¨
        return true;
    }

    @Override
    public Object run() throws ZuulException {
        // è·å–è¯·æ±‚ä¸Šä¸‹æ–‡
        RequestContext ctx = RequestContext.getCurrentContext();
        HttpServletRequest request = ctx.getRequest();
        
        // è®°å½•è¯·æ±‚ä¿¡æ¯
        logger.info("Request URL: {}", request.getRequestURL());
        logger.info("Request Method: {}", request.getMethod());
        
        // å¯ä»¥ä¿®æ”¹è¯·æ±‚ä¸Šä¸‹æ–‡
        // ctx.setSendZuulResponse(false);
        // ctx.setResponseStatusCode(401);
        // ctx.setResponseBody("Unauthorized");
        
        return null;
    }
}
```

#### 4.3.3 Kong

Kongæ˜¯ä¸€ä¸ªå¼€æºçš„APIç½‘å…³å’ŒæœåŠ¡ç®¡ç†å±‚ï¼Œå®ƒåŸºäºNginxå’ŒOpenRestyæ„å»ºï¼Œæä¾›äº†è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯æˆæƒã€é™æµç†”æ–­ç­‰åŠŸèƒ½ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- æ”¯æŒæ’ä»¶æ‰©å±•
- æ”¯æŒåŠ¨æ€é…ç½®
- æ”¯æŒè´Ÿè½½å‡è¡¡
- æ”¯æŒé™æµç†”æ–­
- æ”¯æŒç›‘æ§
- æ”¯æŒå¯è§†åŒ–ç®¡ç†

**é…ç½®ç¤ºä¾‹ï¼ˆä½¿ç”¨Admin APIï¼‰**ï¼š

```bash
# æ·»åŠ æœåŠ¡
curl -i -X POST \
  --url http://localhost:8001/services/ \
  --data 'name=user-service' \
  --data 'url=http://user-service:8080'

# æ·»åŠ è·¯ç”±
curl -i -X POST \
  --url http://localhost:8001/services/user-service/routes \
  --data 'paths[]=/api/users' \
  --data 'strip_path=true'

# å¯ç”¨è®¤è¯æ’ä»¶
curl -i -X POST \
  --url http://localhost:8001/services/user-service/plugins \
  --data 'name=jwt'

# å¯ç”¨é™æµæ’ä»¶
curl -i -X POST \
  --url http://localhost:8001/services/user-service/plugins \
  --data 'name=rate-limiting' \
  --data 'config.minute=10' \
  --data 'config.policy=local'```

### 4.4 APIç½‘å…³çš„æœ€ä½³å®è·µ

åœ¨è®¾è®¡å’Œå®ç°APIç½‘å…³æ—¶ï¼Œåº”éµå¾ªä»¥ä¸‹æœ€ä½³å®è·µï¼š

#### 4.4.1 æ€§èƒ½ä¼˜åŒ–

- **ç¼“å­˜å¸¸ç”¨å“åº”**ï¼šå¯¹é¢‘ç¹è¯·æ±‚çš„å“åº”è¿›è¡Œç¼“å­˜ï¼Œå‡å°‘åç«¯æœåŠ¡çš„è´Ÿè½½
- **è¯·æ±‚èšåˆ**ï¼šå°†å¤šä¸ªè¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°
- **å“åº”å‹ç¼©**ï¼šå¯¹å“åº”æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘ä¼ è¾“æ•°æ®é‡
- **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨å¼‚æ­¥å¤„ç†æ¨¡å¼ï¼Œæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›
- **è¿æ¥æ± **ï¼šä½¿ç”¨è¿æ¥æ± ç®¡ç†ä¸åç«¯æœåŠ¡çš„è¿æ¥

#### 4.4.2 å¯ç”¨æ€§è®¾è®¡

- **é›†ç¾¤éƒ¨ç½²**ï¼šå¤šå®ä¾‹éƒ¨ç½²APIç½‘å…³ï¼Œæé«˜å¯ç”¨æ€§
- **å¥åº·æ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥åç«¯æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œè‡ªåŠ¨å‰”é™¤ä¸å¥åº·çš„æœåŠ¡å®ä¾‹
- **ç†”æ–­æœºåˆ¶**ï¼šå½“åç«¯æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œå¿«é€Ÿå¤±è´¥å¹¶è¿”å›é»˜è®¤å“åº”
- **é™çº§ç­–ç•¥**ï¼šå½“ç³»ç»Ÿè´Ÿè½½è¿‡é«˜æ—¶ï¼Œå…³é—­éƒ¨åˆ†éæ ¸å¿ƒåŠŸèƒ½ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½çš„å¯ç”¨æ€§
- **é™æµæªæ–½**ï¼šå¯¹è¯·æ±‚è¿›è¡Œé™æµï¼Œé˜²æ­¢ç³»ç»Ÿè¢«çªå‘æµé‡å†²å®

#### 4.4.3 å®‰å…¨è®¾è®¡

- **è®¤è¯æˆæƒ**ï¼šåœ¨APIç½‘å…³å±‚ç»Ÿä¸€å¤„ç†è®¤è¯å’Œæˆæƒ
- **è¾“å…¥éªŒè¯**ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å‚æ•°è¿›è¡ŒéªŒè¯ï¼Œé˜²æ­¢æ³¨å…¥æ”»å‡»
- **è¯·æ±‚æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰è¯·æ±‚çš„æ—¥å¿—ï¼Œä¾¿äºå®¡è®¡å’Œæ’æŸ¥é—®é¢˜
- **å®‰å…¨é˜²æŠ¤**ï¼šé˜²æ­¢SQLæ³¨å…¥ã€XSSã€CSRFç­‰å¸¸è§çš„Webæ”»å‡»
- **HTTPS**ï¼šä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“æ•°æ®

#### 4.4.4 å¯è§‚æµ‹æ€§è®¾è®¡

- **ç›‘æ§æŒ‡æ ‡**ï¼šæ”¶é›†APIç½‘å…³çš„å…³é”®æŒ‡æ ‡ï¼Œå¦‚è¯·æ±‚é‡ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡ç­‰
- **åˆ†å¸ƒå¼è¿½è¸ª**ï¼šé›†æˆåˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œè¿½è¸ªè¯·æ±‚çš„å®Œæ•´é“¾è·¯
- **æ—¥å¿—èšåˆ**ï¼šå°†APIç½‘å…³çš„æ—¥å¿—èšåˆåˆ°ä¸­å¿ƒåŒ–çš„æ—¥å¿—ç³»ç»Ÿ
- **å‘Šè­¦æœºåˆ¶**ï¼šè®¾ç½®å‘Šè­¦é˜ˆå€¼ï¼Œå½“æŒ‡æ ‡è¶…è¿‡é˜ˆå€¼æ—¶åŠæ—¶å‘Šè­¦

#### 4.4.5 æ‰©å±•æ€§è®¾è®¡

- **æ’ä»¶åŒ–æ¶æ„**ï¼šé‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- **åŠ¨æ€é…ç½®**ï¼šæ”¯æŒåŠ¨æ€æ›´æ–°é…ç½®ï¼Œæ— éœ€é‡å¯APIç½‘å…³
- **è‡ªåŠ¨æ‰©ç¼©å®¹**ï¼šæ”¯æŒæ ¹æ®è´Ÿè½½è‡ªåŠ¨æ‰©ç¼©å®¹
- **ç°åº¦å‘å¸ƒ**ï¼šæ”¯æŒç°åº¦å‘å¸ƒæ–°åŠŸèƒ½ï¼Œé™ä½å‘å¸ƒé£é™©

## äº”ã€APIæ–‡æ¡£ä¸æµ‹è¯•

APIæ–‡æ¡£æ˜¯APIè®¾è®¡çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒæœ‰åŠ©äºå¼€å‘è€…ç†è§£å’Œä½¿ç”¨APIã€‚APIæµ‹è¯•åˆ™æ˜¯ä¿è¯APIè´¨é‡çš„é‡è¦æ‰‹æ®µã€‚

### 5.1 APIæ–‡æ¡£å·¥å…·ä¸ç¤ºä¾‹

#### 5.1.1 Swagger/OpenAPI

Swagger/OpenAPIæ˜¯ç›®å‰æœ€æµè¡Œçš„APIæ–‡æ¡£å·¥å…·ï¼Œå®ƒæä¾›äº†APIè®¾è®¡ã€æ–‡æ¡£ç”Ÿæˆã€æµ‹è¯•ç­‰åŠŸèƒ½ã€‚

**é…ç½®ç¤ºä¾‹ï¼ˆSpring Boot + SpringFoxï¼‰**ï¼š

```java
@Configuration
@EnableSwagger2
public class SwaggerConfig {

    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.example.api"))
                .paths(PathSelectors.any())
                .build()
                .apiInfo(apiInfo())
                .securitySchemes(Arrays.asList(apiKey()))
                .securityContexts(Arrays.asList(securityContext()));
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("API Documentation")
                .description("API Documentation for User Service")
                .version("1.0.0")
                .build();
    }

    private ApiKey apiKey() {
        return new ApiKey("JWT", "Authorization", "header");
    }

    private SecurityContext securityContext() {
        return SecurityContext.builder()
                .securityReferences(defaultAuth())
                .forPaths(PathSelectors.any())
                .build();
    }

    List<SecurityReference> defaultAuth() {
        AuthorizationScope authorizationScope = new AuthorizationScope("global", "accessEverything");
        AuthorizationScope[] authorizationScopes = new AuthorizationScope[1];
        authorizationScopes[0] = authorizationScope;
        return Arrays.asList(new SecurityReference("JWT", authorizationScopes));
    }
}
```

**Controllerç¤ºä¾‹**ï¼š

```java
@RestController
@RequestMapping("/api/users")
@Api(tags = "User Management")
public class UserController {

    @Autowired
    private UserService userService;

    @GetMapping
    @ApiOperation("Get all users")
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = "Successfully retrieved users"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden")
    })
    public ResponseEntity<List<User>> getAllUsers() {
        List<User> users = userService.getAllUsers();
        return ResponseEntity.ok(users);
    }

    @GetMapping("/{id}")
    @ApiOperation("Get user by ID")
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = "Successfully retrieved user"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden"),
            @ApiResponse(code = 404, message = "User not found")
    })
    public ResponseEntity<User> getUserById(@PathVariable Long id) {
        User user = userService.getUserById(id)
                .orElseThrow(() -> new ResourceNotFoundException("User not found with id: " + id));
        return ResponseEntity.ok(user);
    }

    @PostMapping
    @ApiOperation("Create a new user")
    @ApiResponses(value = {
            @ApiResponse(code = 201, message = "Successfully created user"),
            @ApiResponse(code = 400, message = "Invalid input"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden")
    })
    public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
        User createdUser = userService.createUser(user);
        return new ResponseEntity<>(createdUser, HttpStatus.CREATED);
    }

    @PutMapping("/{id}")
    @ApiOperation("Update a user")
    @ApiResponses(value = {
            @ApiResponse(code = 200, message = "Successfully updated user"),
            @ApiResponse(code = 400, message = "Invalid input"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden"),
            @ApiResponse(code = 404, message = "User not found")
    })
    public ResponseEntity<User> updateUser(@PathVariable Long id, @Valid @RequestBody User user) {
        User updatedUser = userService.updateUser(id, user);
        return ResponseEntity.ok(updatedUser);
    }

    @DeleteMapping("/{id}")
    @ApiOperation("Delete a user")
    @ApiResponses(value = {
            @ApiResponse(code = 204, message = "Successfully deleted user"),
            @ApiResponse(code = 401, message = "Unauthorized"),
            @ApiResponse(code = 403, message = "Forbidden"),
            @ApiResponse(code = 404, message = "User not found")
    })
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.deleteUser(id);
        return ResponseEntity.noContent().build();
    }
}
```

#### 2.3.2 POSTæ–¹æ³•

POSTæ–¹æ³•ç”¨äºåˆ›å»ºæ–°èµ„æºï¼Œä¸ä¿è¯å¹‚ç­‰æ€§ã€‚

**ç¤ºä¾‹**ï¼š

```http
# åˆ›å»ºæ–°ç”¨æˆ·
POST /users HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123"
}

# ä¸ºç”¨æˆ·åˆ›å»ºè®¢å•
POST /users/123/orders HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "items": [
    {
      "productId": 456,
      "quantity": 2
    }
  ],
  "totalAmount": 99.99
}
```

#### 2.3.3 PUTæ–¹æ³•

PUTæ–¹æ³•ç”¨äºæ›´æ–°èµ„æºçš„å…¨éƒ¨å†…å®¹ï¼Œåº”è¯¥æ˜¯å¹‚ç­‰çš„ã€‚

**ç¤ºä¾‹**ï¼š

```http
# æ›´æ–°ç”¨æˆ·ä¿¡æ¯
PUT /users/123 HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "id": 123,
  "name": "Jane Doe",
  "email": "jane@example.com",
  "password": "newpassword123"
}
```

#### 2.3.4 PATCHæ–¹æ³•

PATCHæ–¹æ³•ç”¨äºéƒ¨åˆ†æ›´æ–°èµ„æºï¼Œä¸ä¿è¯å¹‚ç­‰æ€§ã€‚

**ç¤ºä¾‹**ï¼š

```http
# éƒ¨åˆ†æ›´æ–°ç”¨æˆ·ä¿¡æ¯
PATCH /users/123 HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "email": "jane.doe@example.com"
}
```

#### 2.3.5 DELETEæ–¹æ³•

DELETEæ–¹æ³•ç”¨äºåˆ é™¤èµ„æºï¼Œåº”è¯¥æ˜¯å¹‚ç­‰çš„ã€‚

**ç¤ºä¾‹**ï¼š

```http
# åˆ é™¤ç”¨æˆ·
DELETE /users/123 HTTP/1.1
Host: api.example.com

# åˆ é™¤è®¢å•
DELETE /orders/456 HTTP/1.1
Host: api.example.com
```

### 2.4 çŠ¶æ€ç çš„ä½¿ç”¨

RESTful APIä½¿ç”¨HTTPçŠ¶æ€ç æ¥è¡¨ç¤ºè¯·æ±‚çš„å¤„ç†ç»“æœï¼Œå¸¸è§çš„HTTPçŠ¶æ€ç åŠå…¶ç”¨é€”å¦‚ä¸‹ï¼š

#### 2.4.1 1xxï¼ˆä¿¡æ¯æ€§çŠ¶æ€ç ï¼‰

- **100 Continue**ï¼šæœåŠ¡å™¨å·²æ”¶åˆ°è¯·æ±‚å¤´ï¼Œå®¢æˆ·ç«¯åº”ç»§ç»­å‘é€è¯·æ±‚ä½“
- **101 Switching Protocols**ï¼šæœåŠ¡å™¨åŒæ„å®¢æˆ·ç«¯çš„åè®®åˆ‡æ¢è¯·æ±‚

#### 2.4.2 2xxï¼ˆæˆåŠŸçŠ¶æ€ç ï¼‰

- **200 OK**ï¼šè¯·æ±‚æˆåŠŸï¼Œè¿”å›è¯·æ±‚çš„èµ„æº
- **201 Created**ï¼šè¯·æ±‚æˆåŠŸåˆ›å»ºæ–°èµ„æºï¼ŒLocationå¤´åŒ…å«æ–°èµ„æºçš„URI
- **202 Accepted**ï¼šè¯·æ±‚å·²æ¥å—ï¼Œä½†å°šæœªå¤„ç†å®Œæˆ
- **204 No Content**ï¼šè¯·æ±‚æˆåŠŸï¼Œä½†æ²¡æœ‰å†…å®¹è¿”å›
- **206 Partial Content**ï¼šè¯·æ±‚æˆåŠŸï¼Œè¿”å›éƒ¨åˆ†èµ„æºï¼ˆç”¨äºèŒƒå›´è¯·æ±‚ï¼‰

#### 2.4.3 3xxï¼ˆé‡å®šå‘çŠ¶æ€ç ï¼‰

- **301 Moved Permanently**ï¼šèµ„æºå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°URI
- **302 Found**ï¼šèµ„æºä¸´æ—¶ç§»åŠ¨åˆ°æ–°URI
- **303 See Other**ï¼šé‡å®šå‘åˆ°å¦ä¸€ä¸ªURIï¼Œé€šå¸¸ç”¨äºPOSTåçš„é‡å®šå‘
- **304 Not Modified**ï¼šèµ„æºæœªä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ç¼“å­˜çš„ç‰ˆæœ¬
- **307 Temporary Redirect**ï¼šä¸´æ—¶é‡å®šå‘ï¼Œä¿æŒåŸHTTPæ–¹æ³•
- **308 Permanent Redirect**ï¼šæ°¸ä¹…é‡å®šå‘ï¼Œä¿æŒåŸHTTPæ–¹æ³•

#### 2.4.4 4xxï¼ˆå®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç ï¼‰

- **400 Bad Request**ï¼šè¯·æ±‚æ ¼å¼é”™è¯¯æˆ–å‚æ•°æ— æ•ˆ
- **401 Unauthorized**ï¼šè¯·æ±‚éœ€è¦è®¤è¯
- **403 Forbidden**ï¼šæœåŠ¡å™¨æ‹’ç»è¯·æ±‚ï¼Œè®¤è¯é€šè¿‡ä½†æƒé™ä¸è¶³
- **404 Not Found**ï¼šè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨
- **405 Method Not Allowed**ï¼šè¯·æ±‚çš„HTTPæ–¹æ³•ä¸è¢«å…è®¸
- **406 Not Acceptable**ï¼šæœåŠ¡å™¨æ— æ³•æä¾›å®¢æˆ·ç«¯è¯·æ±‚çš„è¡¨ç¤ºå½¢å¼
- **409 Conflict**ï¼šè¯·æ±‚ä¸æœåŠ¡å™¨å½“å‰çŠ¶æ€å†²çª
- **410 Gone**ï¼šè¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…åˆ é™¤
- **429 Too Many Requests**ï¼šå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚è¿‡å¤š

#### 2.4.5 5xxï¼ˆæœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç ï¼‰

- **500 Internal Server Error**ï¼šæœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- **501 Not Implemented**ï¼šæœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½
- **502 Bad Gateway**ï¼šæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°æ— æ•ˆå“åº”
- **503 Service Unavailable**ï¼šæœåŠ¡å™¨å½“å‰æ— æ³•å¤„ç†è¯·æ±‚ï¼ˆé€šå¸¸æ˜¯ä¸´æ—¶çŠ¶æ€ï¼‰
- **504 Gateway Timeout**ï¼šæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼ŒæœªåŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°å“åº”

### 2.5 è¯·æ±‚å’Œå“åº”è®¾è®¡

#### 2.5.1 è¯·æ±‚è®¾è®¡

- **å‚æ•°è®¾è®¡**ï¼šåˆç†è®¾è®¡æŸ¥è¯¢å‚æ•°ã€è·¯å¾„å‚æ•°å’Œè¯·æ±‚ä½“å‚æ•°
- **åˆ†é¡µè®¾è®¡**ï¼šæ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼Œå¸¸è§å‚æ•°åŒ…æ‹¬pageï¼ˆé¡µç ï¼‰ã€sizeï¼ˆæ¯é¡µæ•°é‡ï¼‰
- **æ’åºè®¾è®¡**ï¼šæ”¯æŒæ’åºï¼Œå¸¸è§å‚æ•°åŒ…æ‹¬sortï¼ˆæ’åºå­—æ®µå’Œæ–¹å‘ï¼‰
- **è¿‡æ»¤è®¾è®¡**ï¼šæ”¯æŒè¿‡æ»¤ï¼Œä½¿ç”¨æŸ¥è¯¢å‚æ•°æŒ‡å®šè¿‡æ»¤æ¡ä»¶
- **å†…å®¹ç±»å‹**ï¼šæ˜ç¡®æŒ‡å®šè¯·æ±‚çš„Content-Type

**ç¤ºä¾‹**ï¼š

```http
# å¸¦åˆ†é¡µã€æ’åºå’Œè¿‡æ»¤çš„è¯·æ±‚
GET /products?page=1&size=10&sort=price,desc&category=electronics&price_lte=1000 HTTP/1.1
Host: api.example.com
Accept: application/json
```

#### 2.5.2 å“åº”è®¾è®¡

- **ç»Ÿä¸€æ ¼å¼**ï¼šä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼ŒåŒ…æ‹¬çŠ¶æ€ç ã€æ¶ˆæ¯å’Œæ•°æ®
- **åˆ†é¡µå“åº”**ï¼šåˆ†é¡µæŸ¥è¯¢çš„å“åº”åº”åŒ…å«åˆ†é¡µä¿¡æ¯
- **é”™è¯¯å¤„ç†**ï¼šé”™è¯¯å“åº”åº”åŒ…å«è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- **è¶…åª’ä½“é“¾æ¥**ï¼šåœ¨å“åº”ä¸­åŒ…å«ç›¸å…³èµ„æºçš„é“¾æ¥
- **å†…å®¹åå•†**ï¼šæ”¯æŒå†…å®¹åå•†ï¼Œæ ¹æ®Acceptå¤´è¿”å›ä¸åŒæ ¼å¼çš„å“åº”

**ç¤ºä¾‹**ï¼š

```json
// æˆåŠŸå“åº”ç¤ºä¾‹
{
  "code": 200,
  "message": "Success",
  "data": {
    "id": 123,
    "name": "John Doe",
    "email": "john@example.com",
    "createdAt": "2023-01-01T12:00:00Z",
    "updatedAt": "2023-01-01T12:00:00Z",
    "_links": {
      "self": {
        "href": "/users/123"
      },
      "orders": {
        "href": "/users/123/orders"
      }
    }
  }
}

// åˆ†é¡µå“åº”ç¤ºä¾‹
{
  "code": 200,
  "message": "Success",
  "data": {
    "content": [
      {
        "id": 1,
        "name": "Product 1",
        "price": 99.99
      },
      {
        "id": 2,
        "name": "Product 2",
        "price": 199.99
      }
    ],
    "pageable": {
      "pageNumber": 0,
      "pageSize": 10,
      "sort": {
        "sorted": true,
        "unsorted": false,
        "empty": false
      },
      "offset": 0,
      "unpaged": false,
      "paged": true
    },
    "totalPages": 5,
    "totalElements": 45,
    "last": false,
    "size": 10,
    "number": 0,
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    },
    "numberOfElements": 10,
    "first": true,
    "empty": false
  }
}

// é”™è¯¯å“åº”ç¤ºä¾‹
{
  "code": 400,
  "message": "Bad Request",
  "errors": [
    {
      "field": "email",
      "message": "Invalid email format"
    },
    {
      "field": "password",
      "message": "Password must be at least 8 characters long"
    }
  ]
}
```

### 2.6 RESTful APIçš„å®‰å…¨è®¾è®¡

RESTful APIçš„å®‰å…¨è®¾è®¡æ˜¯éå¸¸é‡è¦çš„ï¼Œå¸¸è§çš„å®‰å…¨æªæ–½åŒ…æ‹¬ï¼š

- **è®¤è¯**ï¼šä½¿ç”¨OAuth 2.0ã€JWTç­‰æœºåˆ¶è¿›è¡Œè®¤è¯
- **æˆæƒ**ï¼šä½¿ç”¨RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ç­‰æœºåˆ¶è¿›è¡Œæˆæƒ
- **HTTPS**ï¼šä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“æ•°æ®
- **è¾“å…¥éªŒè¯**ï¼šéªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°ï¼Œé˜²æ­¢æ³¨å…¥æ”»å‡»
- **è¾“å‡ºç¼–ç **ï¼šå¯¹è¾“å‡ºæ•°æ®è¿›è¡Œç¼–ç ï¼Œé˜²æ­¢XSSæ”»å‡»
- **é™æµ**ï¼šé™åˆ¶APIçš„è®¿é—®é¢‘ç‡ï¼Œé˜²æ­¢DoSæ”»å‡»
- **CSRFé˜²æŠ¤**ï¼šé˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»
- **CORSé…ç½®**ï¼šåˆç†é…ç½®è·¨åŸŸèµ„æºå…±äº«

**ç¤ºä¾‹**ï¼š

```http
# ä½¿ç”¨Bearer Tokenè¿›è¡Œè®¤è¯
GET /users HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“
GET https://api.example.com/users HTTP/1.1
```

### 2.7 RESTful APIçš„ç‰ˆæœ¬æ§åˆ¶

APIç‰ˆæœ¬æ§åˆ¶æ˜¯ç¡®ä¿å‘åå…¼å®¹æ€§çš„é‡è¦æ‰‹æ®µï¼Œå¸¸è§çš„ç‰ˆæœ¬æ§åˆ¶æ–¹æ³•åŒ…æ‹¬ï¼š

- **URIè·¯å¾„ç‰ˆæœ¬**ï¼šå°†ç‰ˆæœ¬ä¿¡æ¯æ”¾åœ¨URIè·¯å¾„ä¸­ï¼Œå¦‚/v1/usersã€/v2/users
- **æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬**ï¼šå°†ç‰ˆæœ¬ä¿¡æ¯ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼Œå¦‚/users?version=1
- **è¯·æ±‚å¤´ç‰ˆæœ¬**ï¼šå°†ç‰ˆæœ¬ä¿¡æ¯æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼Œå¦‚Accept: application/vnd.example.v1+json
- **å†…å®¹åå•†ç‰ˆæœ¬**ï¼šä½¿ç”¨å†…å®¹åå•†æœºåˆ¶æŒ‡å®šç‰ˆæœ¬

**ç¤ºä¾‹**ï¼š

```http
# URIè·¯å¾„ç‰ˆæœ¬
GET /v1/users HTTP/1.1
Host: api.example.com

# æŸ¥è¯¢å‚æ•°ç‰ˆæœ¬
GET /users?version=1 HTTP/1.1
Host: api.example.com

# è¯·æ±‚å¤´ç‰ˆæœ¬
GET /users HTTP/1.1
Host: api.example.com
Accept: application/vnd.example.v1+json
```

## ä¸‰ã€GraphQL APIè®¾è®¡

GraphQLæ˜¯ä¸€ç§ç”¨äºAPIçš„æŸ¥è¯¢è¯­è¨€å’Œè¿è¡Œæ—¶ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯ç²¾ç¡®åœ°æŒ‡å®šéœ€è¦çš„æ•°æ®ï¼Œé¿å…äº†REST APIä¸­å¸¸è§çš„è¿‡åº¦è·å–å’Œè·å–ä¸è¶³é—®é¢˜ã€‚

### 3.1 GraphQLçš„æ ¸å¿ƒæ¦‚å¿µ

- **Schema**ï¼šå®šä¹‰APIçš„æ•°æ®ç»“æ„å’Œæ“ä½œç±»å‹
- **Query**ï¼šç”¨äºè·å–æ•°æ®çš„æ“ä½œç±»å‹ï¼Œç±»ä¼¼äºRESTçš„GET
- **Mutation**ï¼šç”¨äºä¿®æ”¹æ•°æ®çš„æ“ä½œç±»å‹ï¼Œç±»ä¼¼äºRESTçš„POSTã€PUTã€DELETE
- **Subscription**ï¼šç”¨äºè®¢é˜…å®æ—¶æ›´æ–°çš„æ“ä½œç±»å‹
- **Type**ï¼šå®šä¹‰æ•°æ®çš„ç±»å‹ï¼ŒåŒ…æ‹¬æ ‡é‡ç±»å‹å’Œå¯¹è±¡ç±»å‹
- **Field**ï¼šç±»å‹ä¸­çš„å­—æ®µï¼Œè¡¨ç¤ºæ•°æ®çš„å±æ€§
- **Argument**ï¼šå­—æ®µå¯ä»¥æ¥å—å‚æ•°ï¼Œç”¨äºè¿‡æ»¤ã€æ’åºç­‰æ“ä½œ
- **Resolver**ï¼šç”¨äºè§£æå­—æ®µå€¼çš„å‡½æ•°

### 3.2 Schemaè®¾è®¡

Schemaæ˜¯GraphQL APIçš„æ ¸å¿ƒï¼Œå®ƒå®šä¹‰äº†APIçš„æ•°æ®ç»“æ„å’Œæ“ä½œç±»å‹ã€‚

#### 3.2.1 ç±»å‹å®šä¹‰

GraphQLæ”¯æŒå¤šç§ç±»å‹ï¼ŒåŒ…æ‹¬ï¼š

- **æ ‡é‡ç±»å‹**ï¼šIntã€Floatã€Stringã€Booleanã€IDç­‰
- **å¯¹è±¡ç±»å‹**ï¼šè‡ªå®šä¹‰çš„å¤æ‚ç±»å‹
- **æ¥å£ç±»å‹**ï¼šå®šä¹‰ä¸€ç»„å­—æ®µï¼Œå…¶ä»–ç±»å‹å¯ä»¥å®ç°è¿™äº›å­—æ®µ
- **è”åˆç±»å‹**ï¼šè¡¨ç¤ºä¸€ä¸ªå€¼å¯èƒ½æ˜¯å¤šç§ç±»å‹ä¸­çš„ä¸€ç§
- **æšä¸¾ç±»å‹**ï¼šå®šä¹‰ä¸€ç»„å‘½åçš„å¸¸é‡å€¼
- **è¾“å…¥ç±»å‹**ï¼šç”¨äºMutationæ“ä½œä¸­çš„å‚æ•°ç±»å‹
- **åˆ—è¡¨ç±»å‹**ï¼šè¡¨ç¤ºä¸€ä¸ªå€¼æ˜¯æŸç§ç±»å‹çš„åˆ—è¡¨
- **éç©ºç±»å‹**ï¼šè¡¨ç¤ºä¸€ä¸ªå€¼ä¸èƒ½ä¸ºnull

**ç¤ºä¾‹**ï¼š

```graphql
# å®šä¹‰å¯¹è±¡ç±»å‹
type User {
  id: ID! # éç©ºIDç±»å‹
  name: String! # éç©ºStringç±»å‹
  email: String! # éç©ºStringç±»å‹
  age: Int # å¯é€‰Intç±»å‹
  createdAt: String! # éç©ºStringç±»å‹
  updatedAt: String! # éç©ºStringç±»å‹
  orders: [Order!]! # éç©ºOrderç±»å‹çš„éç©ºåˆ—è¡¨
}

# å®šä¹‰å¯¹è±¡ç±»å‹
type Product {
  id: ID! # éç©ºIDç±»å‹
  name: String! # éç©ºStringç±»å‹
  description: String # å¯é€‰Stringç±»å‹
  price: Float! # éç©ºFloatç±»å‹
  category: String! # éç©ºStringç±»å‹
  createdAt: String! # éç©ºStringç±»å‹
  updatedAt: String! # éç©ºStringç±»å‹
}

# å®šä¹‰å¯¹è±¡ç±»å‹
type Order {
  id: ID! # éç©ºIDç±»å‹
  userId: ID! # éç©ºIDç±»å‹
  items: [OrderItem!]! # éç©ºOrderItemç±»å‹çš„éç©ºåˆ—è¡¨
  totalAmount: Float! # éç©ºFloatç±»å‹
  status: OrderStatus! # éç©ºOrderStatusç±»å‹
  createdAt: String! # éç©ºStringç±»å‹
  updatedAt: String! # éç©ºStringç±»å‹
  user: User! # éç©ºUserç±»å‹
}

# å®šä¹‰å¯¹è±¡ç±»å‹
type OrderItem {
  id: ID! # éç©ºIDç±»å‹
  orderId: ID! # éç©ºIDç±»å‹
  productId: ID! # éç©ºIDç±»å‹
  quantity: Int! # éç©ºIntç±»å‹
  price: Float! # éç©ºFloatç±»å‹
  product: Product! # éç©ºProductç±»å‹
}

# å®šä¹‰æšä¸¾ç±»å‹
enum OrderStatus {
  PENDING # å¾…å¤„ç†
  PAID # å·²æ”¯ä»˜
  SHIPPED # å·²å‘è´§
  DELIVERED # å·²é€è¾¾
  CANCELLED # å·²å–æ¶ˆ
}

# å®šä¹‰è¾“å…¥ç±»å‹
input CreateUserInput {
  name: String! # éç©ºStringç±»å‹
  email: String! # éç©ºStringç±»å‹
  password: String! # éç©ºStringç±»å‹
  age: Int # å¯é€‰Intç±»å‹
}

# å®šä¹‰è¾“å…¥ç±»å‹
input UpdateUserInput {
  id: ID! # éç©ºIDç±»å‹
  name: String # å¯é€‰Stringç±»å‹
  email: String # å¯é€‰Stringç±»å‹
  password: String # å¯é€‰Stringç±»å‹
  age: Int # å¯é€‰Intç±»å‹
}

# å®šä¹‰è¾“å…¥ç±»å‹
input CreateOrderInput {
  userId: ID! # éç©ºIDç±»å‹
  items: [CreateOrderItemInput!]! # éç©ºCreateOrderItemInputç±»å‹çš„éç©ºåˆ—è¡¨
}

# å®šä¹‰è¾“å…¥ç±»å‹
input CreateOrderItemInput {
  productId: ID! # éç©ºIDç±»å‹
  quantity: Int! # éç©ºIntç±»å‹
}
```

#### 3.2.2 æ“ä½œç±»å‹å®šä¹‰

GraphQLæ”¯æŒä¸‰ç§æ“ä½œç±»å‹ï¼šQueryï¼ˆæŸ¥è¯¢ï¼‰ã€Mutationï¼ˆå˜æ›´ï¼‰å’ŒSubscriptionï¼ˆè®¢é˜…ï¼‰ã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# å®šä¹‰æŸ¥è¯¢æ“ä½œç±»å‹
type Query {
  # è·å–æ‰€æœ‰ç”¨æˆ·
  users(page: Int, size: Int, sort: String): [User!]! 
  
  # è·å–å•ä¸ªç”¨æˆ·
  user(id: ID!): User 
  
  # è·å–æ‰€æœ‰å•†å“
  products(page: Int, size: Int, sort: String, category: String, priceGte: Float, priceLte: Float): [Product!]! 
  
  # è·å–å•ä¸ªå•†å“
  product(id: ID!): Product 
  
  # è·å–æ‰€æœ‰è®¢å•
  orders(page: Int, size: Int, sort: String, status: OrderStatus, userId: ID): [Order!]! 
  
  # è·å–å•ä¸ªè®¢å•
  order(id: ID!): Order 
}

# å®šä¹‰å˜æ›´æ“ä½œç±»å‹
type Mutation {
  # åˆ›å»ºç”¨æˆ·
  createUser(input: CreateUserInput!): User! 
  
  # æ›´æ–°ç”¨æˆ·
  updateUser(input: UpdateUserInput!): User! 
  
  # åˆ é™¤ç”¨æˆ·
  deleteUser(id: ID!): Boolean! 
  
  # åˆ›å»ºè®¢å•
  createOrder(input: CreateOrderInput!): Order! 
  
  # æ›´æ–°è®¢å•çŠ¶æ€
  updateOrderStatus(id: ID!, status: OrderStatus!): Order! 
  
  # åˆ é™¤è®¢å•
  deleteOrder(id: ID!): Boolean! 
}

# å®šä¹‰è®¢é˜…æ“ä½œç±»å‹
type Subscription {
  # è®¢é˜…è®¢å•åˆ›å»ºäº‹ä»¶
  orderCreated: Order! 
  
  # è®¢é˜…è®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
  orderStatusUpdated: Order! 
}
```

### 3.3 æŸ¥è¯¢è®¾è®¡

GraphQLæŸ¥è¯¢å…è®¸å®¢æˆ·ç«¯ç²¾ç¡®åœ°æŒ‡å®šéœ€è¦çš„æ•°æ®ï¼Œé¿å…äº†REST APIä¸­å¸¸è§çš„è¿‡åº¦è·å–å’Œè·å–ä¸è¶³é—®é¢˜ã€‚

#### 3.3.1 åŸºæœ¬æŸ¥è¯¢

åŸºæœ¬æŸ¥è¯¢ç”¨äºè·å–å•ä¸ªæˆ–å¤šä¸ªèµ„æºã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# æŸ¥è¯¢å•ä¸ªç”¨æˆ·
query {
  user(id: "123") {
    id
    name
    email
    age
  }
}

# æŸ¥è¯¢å¤šä¸ªç”¨æˆ·
query {
  users(page: 1, size: 10) {
    id
    name
    email
  }
}
```

#### 3.3.2 åµŒå¥—æŸ¥è¯¢

GraphQLæ”¯æŒåµŒå¥—æŸ¥è¯¢ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è·å–ç›¸å…³è”çš„èµ„æºã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# æŸ¥è¯¢è®¢å•åŠå…¶å…³è”çš„ç”¨æˆ·å’Œå•†å“
query {
  order(id: "456") {
    id
    totalAmount
    status
    createdAt
    user {
      id
      name
      email
    }
    items {
      id
      quantity
      price
      product {
        id
        name
        price
        category
      }
    }
  }
}
```

#### 3.3.3 å‚æ•°åŒ–æŸ¥è¯¢

GraphQLæŸ¥è¯¢å¯ä»¥æ¥å—å‚æ•°ï¼Œç”¨äºè¿‡æ»¤ã€æ’åºå’Œåˆ†é¡µç­‰æ“ä½œã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# å¸¦å‚æ•°çš„å•†å“æŸ¥è¯¢
query {
  products(
    page: 1,
    size: 10,
    sort: "price_DESC",
    category: "electronics",
    priceLte: 1000
  ) {
    id
    name
    price
    category
  }
}

# å¸¦å‚æ•°çš„è®¢å•æŸ¥è¯¢
query {
  orders(
    status: PAID,
    userId: "123"
  ) {
    id
    totalAmount
    status
    createdAt
    items {
      id
      quantity
      product {
        id
        name
      }
    }
  }
}
```

#### 3.3.4 å‘½åæŸ¥è¯¢å’Œå˜é‡

GraphQLæ”¯æŒå‘½åæŸ¥è¯¢å’Œå˜é‡ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢çš„å¯é‡ç”¨æ€§å’Œå¯è¯»æ€§ã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# å‘½åæŸ¥è¯¢å’Œå˜é‡
query GetUserById($userId: ID!) {
  user(id: $userId) {
    id
    name
    email
    age
    orders {
      id
      totalAmount
      status
    }
  }
}

# å˜é‡å€¼
{
  "userId": "123"
}

# å¸¦å¤šä¸ªå˜é‡çš„æŸ¥è¯¢
query GetProducts(
  $page: Int,
  $size: Int,
  $sort: String,
  $category: String,
  $priceRange: PriceRangeInput
) {
  products(
    page: $page,
    size: $size,
    sort: $sort,
    category: $category,
    priceGte: $priceRange.min,
    priceLte: $priceRange.max
  ) {
    id
    name
    price
    category
  }
}

# å˜é‡å€¼
{
  "page": 1,
  "size": 10,
  "sort": "price_DESC",
  "category": "electronics",
  "priceRange": {
    "min": 100,
    "max": 1000
  }
}
```

### 3.4 Mutationè®¾è®¡

Mutationç”¨äºä¿®æ”¹æ•°æ®ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤æ“ä½œã€‚

#### 3.4.1 åˆ›å»ºæ“ä½œ

åˆ›å»ºæ“ä½œç”¨äºåˆ›å»ºæ–°èµ„æºã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# åˆ›å»ºç”¨æˆ·
mutation {
  createUser(input: {
    name: "John Doe",
    email: "john@example.com",
    password: "password123",
    age: 30
  }) {
    id
    name
    email
    age
    createdAt
  }
}

# åˆ›å»ºè®¢å•
mutation {
  createOrder(input: {
    userId: "123",
    items: [
      {
        productId: "456",
        quantity: 2
      },
      {
        productId: "789",
        quantity: 1
      }
    ]
  }) {
    id
    totalAmount
    status
    createdAt
    items {
      id
      quantity
      price
      product {
        id
        name
      }
    }
  }
}
```

#### 3.4.2 æ›´æ–°æ“ä½œ

æ›´æ–°æ“ä½œç”¨äºæ›´æ–°ç°æœ‰èµ„æºã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# æ›´æ–°ç”¨æˆ·
mutation {
  updateUser(input: {
    id: "123",
    name: "Jane Doe",
    email: "jane@example.com"
  }) {
    id
    name
    email
    updatedAt
  }
}

# æ›´æ–°è®¢å•çŠ¶æ€
mutation {
  updateOrderStatus(id: "456", status: PAID) {
    id
    status
    updatedAt
  }
}
```

#### 3.4.3 åˆ é™¤æ“ä½œ

åˆ é™¤æ“ä½œç”¨äºåˆ é™¤ç°æœ‰èµ„æºã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# åˆ é™¤ç”¨æˆ·
mutation {
  deleteUser(id: "123")
}

# åˆ é™¤è®¢å•
mutation {
  deleteOrder(id: "456")
}
```

#### 3.4.4 å‘½åMutationå’Œå˜é‡

ä¸æŸ¥è¯¢ç±»ä¼¼ï¼ŒMutationä¹Ÿæ”¯æŒå‘½åå’Œå˜é‡ã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# å‘½åMutationå’Œå˜é‡
mutation CreateUser($input: CreateUserInput!) {
  createUser(input: $input) {
    id
    name
    email
    createdAt
  }
}

# å˜é‡å€¼
{
  "input": {
    "name": "John Doe",
    "email": "john@example.com",
    "password": "password123",
    "age": 30
  }
}
```

### 3.5 Subscriptionè®¾è®¡

Subscriptionç”¨äºè®¢é˜…å®æ—¶æ›´æ–°ï¼Œå½“æœåŠ¡å™¨ç«¯çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°é€šçŸ¥ã€‚

**ç¤ºä¾‹**ï¼š

```graphql
# è®¢é˜…è®¢å•åˆ›å»ºäº‹ä»¶
subscription {
  orderCreated {
    id
    totalAmount
    status
    createdAt
    user {
      id
      name
    }
  }
}

# è®¢é˜…è®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
subscription {
  orderStatusUpdated {
    id
    status
    updatedAt
  }
}
```

### 3.6 Resolverè®¾è®¡

Resolveræ˜¯GraphQL APIä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£è§£æå­—æ®µçš„å€¼ã€‚æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Resolverå‡½æ•°ã€‚

#### 3.6.1 åŸºæœ¬Resolver

åŸºæœ¬Resolverç”¨äºè§£æç®€å•å­—æ®µçš„å€¼ã€‚

**ç¤ºä¾‹ï¼ˆNode.js + Apollo Serverï¼‰**ï¼š

```javascript
const resolvers = {
  Query: {
    // è·å–å•ä¸ªç”¨æˆ·
    user: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºè·å–ç”¨æˆ·æ•°æ®
      return db.users.findOne({ id });
    },
    
    // è·å–æ‰€æœ‰ç”¨æˆ·
    users: (parent, args, context, info) => {
      const { page = 1, size = 10, sort = 'createdAt_ASC' } = args;
      // è®¡ç®—åç§»é‡
      const offset = (page - 1) * size;
      // æ„å»ºæ’åºé€‰é¡¹
      const [sortField, sortOrder] = sort.split('_');
      const sortOptions = { [sortField]: sortOrder === 'ASC' ? 1 : -1 };
      // ä»æ•°æ®åº“è·å–ç”¨æˆ·åˆ—è¡¨
      return db.users.find({}).sort(sortOptions).skip(offset).limit(size);
    },
    
    // è·å–å•ä¸ªå•†å“
    product: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“è·å–å•†å“æ•°æ®
      return db.products.findOne({ id });
    },
    
    // è·å–æ‰€æœ‰å•†å“
    products: (parent, args, context, info) => {
      const { page = 1, size = 10, sort = 'createdAt_ASC', category, priceGte, priceLte } = args;
      // è®¡ç®—åç§»é‡
      const offset = (page - 1) * size;
      // æ„å»ºæ’åºé€‰é¡¹
      const [sortField, sortOrder] = sort.split('_');
      const sortOptions = { [sortField]: sortOrder === 'ASC' ? 1 : -1 };
      // æ„å»ºè¿‡æ»¤æ¡ä»¶
      const filter = {};
      if (category) filter.category = category;
      if (priceGte !== undefined) filter.price = { ...filter.price, $gte: priceGte };
      if (priceLte !== undefined) filter.price = { ...filter.price, $lte: priceLte };
      // ä»æ•°æ®åº“è·å–å•†å“åˆ—è¡¨
      return db.products.find(filter).sort(sortOptions).skip(offset).limit(size);
    },
    
    // è·å–å•ä¸ªè®¢å•
    order: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“è·å–è®¢å•æ•°æ®
      return db.orders.findOne({ id });
    },
    
    // è·å–æ‰€æœ‰è®¢å•
    orders: (parent, args, context, info) => {
      const { page = 1, size = 10, sort = 'createdAt_ASC', status, userId } = args;
      // è®¡ç®—åç§»é‡
      const offset = (page - 1) * size;
      // æ„å»ºæ’åºé€‰é¡¹
      const [sortField, sortOrder] = sort.split('_');
      const sortOptions = { [sortField]: sortOrder === 'ASC' ? 1 : -1 };
      // æ„å»ºè¿‡æ»¤æ¡ä»¶
      const filter = {};
      if (status) filter.status = status;
      if (userId) filter.userId = userId;
      // ä»æ•°æ®åº“è·å–è®¢å•åˆ—è¡¨
      return db.orders.find(filter).sort(sortOptions).skip(offset).limit(size);
    },
  },
  
  Mutation: {
    // åˆ›å»ºç”¨æˆ·
    createUser: (parent, args, context, info) => {
      const { input } = args;
      // åˆ›å»ºç”¨æˆ·
      const user = {
        id: generateId(),
        name: input.name,
        email: input.email,
        password: hashPassword(input.password),
        age: input.age,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
      };
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.users.insert(user);
      return user;
    },
    
    // æ›´æ–°ç”¨æˆ·
    updateUser: (parent, args, context, info) => {
      const { input } = args;
      const { id } = input;
      // ä»æ•°æ®åº“è·å–ç”¨æˆ·
      let user = db.users.findOne({ id });
      if (!user) {
        throw new Error(`User with id ${id} not found`);
      }
      // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      user = {
        ...user,
        ...input,
        updatedAt: new Date().toISOString(),
      };
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.users.update({ id }, user);
      return user;
    },
    
    // åˆ é™¤ç”¨æˆ·
    deleteUser: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“åˆ é™¤ç”¨æˆ·
      const result = db.users.remove({ id });
      return result.deletedCount > 0;
    },
    
    // åˆ›å»ºè®¢å•
    createOrder: async (parent, args, context, info) => {
      const { input } = args;
      const { userId, items } = input;
      
      // éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
      const user = db.users.findOne({ id: userId });
      if (!user) {
        throw new Error(`User with id ${userId} not found`);
      }
      
      // éªŒè¯å•†å“æ˜¯å¦å­˜åœ¨å¹¶è®¡ç®—æ€»ä»·
      let totalAmount = 0;
      const orderItems = [];
      
      for (const item of items) {
        const product = db.products.findOne({ id: item.productId });
        if (!product) {
          throw new Error(`Product with id ${item.productId} not found`);
        }
        
        const itemTotal = product.price * item.quantity;
        totalAmount += itemTotal;
        
        orderItems.push({
          id: generateId(),
          productId: item.productId,
          quantity: item.quantity,
          price: product.price,
        });
      }
      
      // åˆ›å»ºè®¢å•
      const order = {
        id: generateId(),
        userId,
        items: orderItems,
        totalAmount,
        status: 'PENDING',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
      };
      
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.orders.insert(order);
      
      // å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
      pubsub.publish('ORDER_CREATED', { orderCreated: order });
      
      return order;
    },
    
    // æ›´æ–°è®¢å•çŠ¶æ€
    updateOrderStatus: (parent, args, context, info) => {
      const { id, status } = args;
      
      // ä»æ•°æ®åº“è·å–è®¢å•
      let order = db.orders.findOne({ id });
      if (!order) {
        throw new Error(`Order with id ${id} not found`);
      }
      
      // æ›´æ–°è®¢å•çŠ¶æ€
      order.status = status;
      order.updatedAt = new Date().toISOString();
      
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.orders.update({ id }, order);
      
      // å‘å¸ƒè®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
      pubsub.publish('ORDER_STATUS_UPDATED', { orderStatusUpdated: order });
      
      return order;
    },
    
    // åˆ é™¤è®¢å•
    deleteOrder: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“åˆ é™¤è®¢å•
      const result = db.orders.remove({ id });
      return result.deletedCount > 0;
    },
  },
  
  Subscription: {
    // è®¢é˜…è®¢å•åˆ›å»ºäº‹ä»¶
    orderCreated: {
      subscribe: () => pubsub.asyncIterator(['ORDER_CREATED']),
    },
    
    // è®¢é˜…è®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
    orderStatusUpdated: {
      subscribe: () => pubsub.asyncIterator(['ORDER_STATUS_UPDATED']),
    },
  },
  
  // åµŒå¥—å­—æ®µçš„Resolver
  User: {
    // è§£æç”¨æˆ·çš„è®¢å•
    orders: (parent, args, context, info) => {
      const { id } = parent;
      return db.orders.find({ userId: id });
    },
  },
  
  Order: {
    // è§£æè®¢å•çš„ç”¨æˆ·
    user: (parent, args, context, info) => {
      const { userId } = parent;
      return db.users.findOne({ id: userId });
    },
    
    // è§£æè®¢å•çš„å•†å“é¡¹
    items: (parent, args, context, info) => {
      const { items } = parent;
      return items;
    },
  },
  
  OrderItem: {
    // è§£æè®¢å•é¡¹çš„å•†å“
    product: (parent, args, context, info) => {
      const { productId } = parent;
      return db.products.findOne({ id: productId });
    },
  },
};
    },
    
    // è·å–æ‰€æœ‰å•†å“
    products: (parent, args, context, info) => {
      const { page = 1, size = 10, sort = 'createdAt_ASC', category, priceGte, priceLte } = args;
      // è®¡ç®—åç§»é‡
      const offset = (page - 1) * size;
      // æ„å»ºæ’åºé€‰é¡¹
      const [sortField, sortOrder] = sort.split('_');
      const sortOptions = { [sortField]: sortOrder === 'ASC' ? 1 : -1 };
      // æ„å»ºè¿‡æ»¤æ¡ä»¶
      const filter = {};
      if (category) filter.category = category;
      if (priceGte !== undefined) filter.price = { ...filter.price, $gte: priceGte };
      if (priceLte !== undefined) filter.price = { ...filter.price, $lte: priceLte };
      // ä»æ•°æ®åº“è·å–å•†å“åˆ—è¡¨
      return db.products.find(filter).sort(sortOptions).skip(offset).limit(size);
    },
    
    // è·å–å•ä¸ªè®¢å•
    order: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“è·å–è®¢å•æ•°æ®
      return db.orders.findOne({ id });
    },
    
    // è·å–æ‰€æœ‰è®¢å•
    orders: (parent, args, context, info) => {
      const { page = 1, size = 10, sort = 'createdAt_ASC', status, userId } = args;
      // è®¡ç®—åç§»é‡
      const offset = (page - 1) * size;
      // æ„å»ºæ’åºé€‰é¡¹
      const [sortField, sortOrder] = sort.split('_');
      const sortOptions = { [sortField]: sortOrder === 'ASC' ? 1 : -1 };
      // æ„å»ºè¿‡æ»¤æ¡ä»¶
      const filter = {};
      if (status) filter.status = status;
      if (userId) filter.userId = userId;
      // ä»æ•°æ®åº“è·å–è®¢å•åˆ—è¡¨
      return db.orders.find(filter).sort(sortOptions).skip(offset).limit(size);
    },
  },
  
  Mutation: {
    // åˆ›å»ºç”¨æˆ·
    createUser: (parent, args, context, info) => {
      const { input } = args;
      // åˆ›å»ºç”¨æˆ·
      const user = {
        id: generateId(),
        name: input.name,
        email: input.email,
        password: hashPassword(input.password),
        age: input.age,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
      };
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.users.insert(user);
      return user;
    },
    
    // æ›´æ–°ç”¨æˆ·
    updateUser: (parent, args, context, info) => {
      const { input } = args;
      const { id } = input;
      // ä»æ•°æ®åº“è·å–ç”¨æˆ·
      let user = db.users.findOne({ id });
      if (!user) {
        throw new Error(`User with id ${id} not found`);
      }
      // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      user = {
        ...user,
        ...input,
        updatedAt: new Date().toISOString(),
      };
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.users.update({ id }, user);
      return user;
    },
    
    // åˆ é™¤ç”¨æˆ·
    deleteUser: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“åˆ é™¤ç”¨æˆ·
      const result = db.users.remove({ id });
      return result.deletedCount > 0;
    },
    
    // åˆ›å»ºè®¢å•
    createOrder: async (parent, args, context, info) => {
      const { input } = args;
      const { userId, items } = input;
      
      // éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
      const user = db.users.findOne({ id: userId });
      if (!user) {
        throw new Error(`User with id ${userId} not found`);
      }
      
      // éªŒè¯å•†å“æ˜¯å¦å­˜åœ¨å¹¶è®¡ç®—æ€»ä»·
      let totalAmount = 0;
      const orderItems = [];
      
      for (const item of items) {
        const product = db.products.findOne({ id: item.productId });
        if (!product) {
          throw new Error(`Product with id ${item.productId} not found`);
        }
        
        const itemTotal = product.price * item.quantity;
        totalAmount += itemTotal;
        
        orderItems.push({
          id: generateId(),
          productId: item.productId,
          quantity: item.quantity,
          price: product.price,
        });
      }
      
      // åˆ›å»ºè®¢å•
      const order = {
        id: generateId(),
        userId,
        items: orderItems,
        totalAmount,
        status: 'PENDING',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
      };
      
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.orders.insert(order);
      
      // å‘å¸ƒè®¢å•åˆ›å»ºäº‹ä»¶
      pubsub.publish('ORDER_CREATED', { orderCreated: order });
      
      return order;
    },
    
    // æ›´æ–°è®¢å•çŠ¶æ€
    updateOrderStatus: (parent, args, context, info) => {
      const { id, status } = args;
      
      // ä»æ•°æ®åº“è·å–è®¢å•
      let order = db.orders.findOne({ id });
      if (!order) {
        throw new Error(`Order with id ${id} not found`);
      }
      
      // æ›´æ–°è®¢å•çŠ¶æ€
      order.status = status;
      order.updatedAt = new Date().toISOString();
      
      // ä¿å­˜åˆ°æ•°æ®åº“
      db.orders.update({ id }, order);
      
      // å‘å¸ƒè®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
      pubsub.publish('ORDER_STATUS_UPDATED', { orderStatusUpdated: order });
      
      return order;
    },
    
    // åˆ é™¤è®¢å•
    deleteOrder: (parent, args, context, info) => {
      const { id } = args;
      // ä»æ•°æ®åº“åˆ é™¤è®¢å•
      const result = db.orders.remove({ id });
      return result.deletedCount > 0;
    },
  },
  
  Subscription: {
    // è®¢é˜…è®¢å•åˆ›å»ºäº‹ä»¶
    orderCreated: {
      subscribe: () => pubsub.asyncIterator(['ORDER_CREATED']),
    },
    
    // è®¢é˜…è®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
    orderStatusUpdated: {
      subscribe: () => pubsub.asyncIterator(['ORDER_STATUS_UPDATED']),
    },
  },
  
  // åµŒå¥—å­—æ®µçš„Resolver
  User: {
    // è§£æç”¨æˆ·çš„è®¢å•
    orders: (parent, args, context, info) => {
      const { id } = parent;
      return db.orders.find({ userId: id });
    },
  },
  
  Order: {
    // è§£æè®¢å•çš„ç”¨æˆ·
    user: (parent, args, context, info) => {
      const { userId } = parent;
      return db.users.findOne({ id: userId });
    },
    
    // è§£æè®¢å•çš„å•†å“é¡¹
    items: (parent, args, context, info) => {
      const { items } = parent;
      return items;
    },
  },
  
  OrderItem: {
    // è§£æè®¢å•é¡¹çš„å•†å“
    product: (parent, args, context, info) => {
      const { productId } = parent;
      return db.products.findOne({ id: productId });
    },
  },
};
```

#### 3.6.2 åµŒå¥—Resolver

åµŒå¥—Resolverç”¨äºè§£æåµŒå¥—å­—æ®µçš„å€¼ï¼Œç‰¹åˆ«æ˜¯å½“éœ€è¦ä»å…¶ä»–æ•°æ®æºè·å–å…³è”æ•°æ®æ—¶ã€‚

**ç¤ºä¾‹ï¼ˆJava + Spring for GraphQLï¼‰**ï¼š

```java
@Controller
public class UserController {
    @Autowired
    private UserService userService;
    
    @Autowired
    private OrderService orderService;
    
    // æŸ¥è¯¢å•ä¸ªç”¨æˆ·
    @QueryMapping
    public User user(@Argument Long id) {
        return userService.findById(id)
                .orElseThrow(() -> new UserNotFoundException("User not found with id: " + id));
    }
    
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    @QueryMapping
    public List<User> users(
            @Argument Integer page,
            @Argument Integer size,
            @Argument String sort) {
        Pageable pageable = PageRequest.of(
                page != null ? page - 1 : 0,
                size != null ? size : 10,
                Sort.by(getSortDirection(sort)));
        return userService.findAll(pageable).getContent();
    }
    
    // è§£æç”¨æˆ·çš„è®¢å•
    @SchemaMapping(typeName = "User", field = "orders")
    public List<Order> orders(User user) {
        return orderService.findByUserId(user.getId());
    }
    
    private Sort.Direction getSortDirection(String sort) {
        if (sort == null || sort.isEmpty()) {
            return Sort.Direction.ASC;
        }
        if (sort.endsWith("_DESC")) {
            return Sort.Direction.DESC;
        }
        return Sort.Direction.ASC;
    }
}

@Controller
public class OrderController {
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private ProductService productService;
    
    // æŸ¥è¯¢å•ä¸ªè®¢å•
    @QueryMapping
    public Order order(@Argument Long id) {
        return orderService.findById(id)
                .orElseThrow(() -> new OrderNotFoundException("Order not found with id: " + id));
    }
    
    // æŸ¥è¯¢æ‰€æœ‰è®¢å•
    @QueryMapping
    public List<Order> orders(
            @Argument Integer page,
            @Argument Integer size,
            @Argument String sort,
            @Argument OrderStatus status,
            @Argument Long userId) {
        Pageable pageable = PageRequest.of(
                page != null ? page - 1 : 0,
                size != null ? size : 10,
                Sort.by(getSortDirection(sort)));
        return orderService.findOrders(pageable, status, userId).getContent();
    }
    
    // åˆ›å»ºè®¢å•
    @MutationMapping
    public Order createOrder(@Argument CreateOrderInput input) {
        return orderService.createOrder(input);
    }
    
    // æ›´æ–°è®¢å•çŠ¶æ€
    @MutationMapping
    public Order updateOrderStatus(@Argument Long id, @Argument OrderStatus status) {
        return orderService.updateOrderStatus(id, status);
    }
    
    // åˆ é™¤è®¢å•
    @MutationMapping
    public boolean deleteOrder(@Argument Long id) {
        orderService.deleteById(id);
        return true;
    }
    
    // è§£æè®¢å•çš„ç”¨æˆ·
    @SchemaMapping(typeName = "Order", field = "user")
    public User user(Order order) {
        return userService.findById(order.getUserId())
                .orElseThrow(() -> new UserNotFoundException("User not found with id: " + order.getUserId()));
    }
    
    // è§£æè®¢å•çš„å•†å“é¡¹
    @SchemaMapping(typeName = "Order", field = "items")
    public List<OrderItem> items(Order order) {
        return order.getItems();
    }
    
    // è§£æè®¢å•é¡¹çš„å•†å“
    @SchemaMapping(typeName = "OrderItem", field = "product")
    public Product product(OrderItem orderItem) {
        return productService.findById(orderItem.getProductId())
                .orElseThrow(() -> new ProductNotFoundException("Product not found with id: " + orderItem.getProductId()));
    }
    
    private Sort.Direction getSortDirection(String sort) {
        if (sort == null || sort.isEmpty()) {
            return Sort.Direction.ASC;
        }
        if (sort.endsWith("_DESC")) {
            return Sort.Direction.DESC;
        }
        return Sort.Direction.ASC;
    }
}

@Controller
public class ProductController {
    @Autowired
    private ProductService productService;
    
    // æŸ¥è¯¢å•ä¸ªå•†å“
    @QueryMapping
    public Product product(@Argument Long id) {
        return productService.findById(id)
                .orElseThrow(() -> new ProductNotFoundException("Product not found with id: " + id));
    }
    
    // æŸ¥è¯¢æ‰€æœ‰å•†å“
    @QueryMapping
    public List<Product> products(
            @Argument Integer page,
            @Argument Integer size,
            @Argument String sort,
            @Argument String category,
            @Argument Double priceGte,
            @Argument Double priceLte) {
        Pageable pageable = PageRequest.of(
                page != null ? page - 1 : 0,
                size != null ? size : 10,
                Sort.by(getSortDirection(sort)));
        return productService.findProducts(pageable, category, priceGte, priceLte).getContent();
    }
    
    private Sort.Direction getSortDirection(String sort) {
        if (sort == null || sort.isEmpty()) {
            return Sort.Direction.ASC;
        }
        if (sort.endsWith("_DESC")) {
            return Sort.Direction.DESC;
        }
        return Sort.Direction.ASC;
    }
}

// è®¢é˜…ç›¸å…³é…ç½®
@Configuration
public class SubscriptionConfig {
    @Bean
    public ExecutorSubscriptionRegistry subscriptionRegistry() {
        return new ExecutorSubscriptionRegistry();
    }
    
    @Bean
    public Publisher<Order> orderCreatedPublisher() {
        return new SimplePublisher<>();
    }
    
    @Bean
    public Publisher<Order> orderStatusUpdatedPublisher() {
        return new SimplePublisher<>();
    }
}

@Controller
public class SubscriptionController {
    @Autowired
    private Publisher<Order> orderCreatedPublisher;
    
    @Autowired
    private Publisher<Order> orderStatusUpdatedPublisher;
    
    // è®¢é˜…è®¢å•åˆ›å»ºäº‹ä»¶
    @SubscriptionMapping("orderCreated")
    public Publisher<Order> orderCreated() {
        return orderCreatedPublisher;
    }
    
    // è®¢é˜…è®¢å•çŠ¶æ€æ›´æ–°äº‹ä»¶
    @SubscriptionMapping("orderStatusUpdated")
    public Publisher<Order> orderStatusUpdated() {
        return orderStatusUpdatedPublisher;
    }
}
```

### 3.7 GraphQL APIçš„å®‰å…¨è®¾è®¡

GraphQL APIçš„å®‰å…¨è®¾è®¡ä¸REST APIç±»ä¼¼ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šçš„è€ƒè™‘å› ç´ ï¼š

- **è®¤è¯å’Œæˆæƒ**ï¼šä½¿ç”¨OAuth 2.0ã€JWTç­‰æœºåˆ¶è¿›è¡Œè®¤è¯å’Œæˆæƒ
- **æŸ¥è¯¢å¤æ‚åº¦æ§åˆ¶**ï¼šé™åˆ¶æŸ¥è¯¢çš„å¤æ‚åº¦ï¼Œé˜²æ­¢æ¶æ„æŸ¥è¯¢è€—å°½æœåŠ¡å™¨èµ„æº
- **æŸ¥è¯¢æ·±åº¦æ§åˆ¶**ï¼šé™åˆ¶æŸ¥è¯¢çš„åµŒå¥—æ·±åº¦ï¼Œé˜²æ­¢æ— é™é€’å½’æŸ¥è¯¢
- **å­—æ®µçº§æƒé™æ§åˆ¶**ï¼šå¯¹ä¸åŒç”¨æˆ·æˆäºˆä¸åŒå­—æ®µçš„è®¿é—®æƒé™
- **æ‰¹é‡æ“ä½œé™åˆ¶**ï¼šé™åˆ¶æ‰¹é‡æ“ä½œçš„æ•°é‡ï¼Œé˜²æ­¢DoSæ”»å‡»
- **è¾“å…¥éªŒè¯**ï¼šéªŒè¯æ‰€æœ‰è¾“å…¥å‚æ•°ï¼Œé˜²æ­¢æ³¨å…¥æ”»å‡»
- **HTTPS**ï¼šä½¿ç”¨HTTPSåŠ å¯†ä¼ è¾“æ•°æ®

**ç¤ºä¾‹ï¼ˆæŸ¥è¯¢å¤æ‚åº¦æ§åˆ¶ï¼‰**ï¼š

```javascript
const { ApolloServer, gql, makeExecutableSchema } = require('apollo-server');
const { createComplexityLimitRule } = require('graphql-validation-complexity');

// å®šä¹‰Schema
const typeDefs = gql`
  type User {
    id: ID!
    name: String!
    email: String!
    orders: [Order!]!
  }
  
  type Order {
    id: ID!
    totalAmount: Float!
    items: [OrderItem!]!
  }
  
  type OrderItem {
    id: ID!
    quantity: Int!
    product: Product!
  }
  
  type Product {
    id: ID!
    name: String!
    price: Float!
  }
  
  type Query {
    user(id: ID!): User
    users: [User!]!
  }
`;

// å®šä¹‰Resolver
const resolvers = {
  Query: {
    user: (parent, args) => { /* å®ç° */ },
    users: (parent, args) => { /* å®ç° */ },
  },
  User: { orders: (parent) => { /* å®ç° */ } },
  Order: { items: (parent) => { /* å®ç° */ } },
  OrderItem: { product: (parent) => { /* å®ç° */ } },
};

// åˆ›å»ºSchema
const schema = makeExecutableSchema({ typeDefs, resolvers });

// åˆ›å»ºæŸ¥è¯¢å¤æ‚åº¦é™åˆ¶è§„åˆ™
const complexityLimitRule = createComplexityLimitRule(1000, {
  onCost: cost => console.log('Query cost:', cost),
  createError: (max, actual) => 
    new Error(`Query is too complex: ${actual}. Maximum allowed complexity: ${max}`),
});

// åˆ›å»ºApollo Server
const server = new ApolloServer({
  schema,
  validationRules: [complexityLimitRule],
  context: ({ req }) => {
    // è®¤è¯é€»è¾‘
    const token = req.headers.authorization || '';
    const user = authenticateUser(token);
    return { user };
  },
});

// å¯åŠ¨æœåŠ¡å™¨
server.listen().then(({ url }) => {
  console.log(`ğŸš€ Server ready at ${url}`);
});
```

## å››ã€APIç½‘å…³è®¾è®¡

APIç½‘å…³æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­çš„é‡è¦ç»„ä»¶ï¼Œå®ƒä½œä¸ºç³»ç»Ÿçš„å”¯ä¸€å…¥å£ï¼Œè´Ÿè´£è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯æˆæƒã€é™æµç†”æ–­ç­‰åŠŸèƒ½ã€‚

### 4.1 APIç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½

- **è¯·æ±‚è·¯ç”±**ï¼šæ ¹æ®è¯·æ±‚è·¯å¾„å°†è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡
- **è´Ÿè½½å‡è¡¡**ï¼šåœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡
- **è®¤è¯æˆæƒ**ï¼šå¯¹è¯·æ±‚è¿›è¡Œè®¤è¯å’Œæˆæƒæ£€æŸ¥
- **é™æµç†”æ–­**ï¼šå¯¹è¯·æ±‚è¿›è¡Œé™æµå’Œç†”æ–­å¤„ç†
- **ç›‘æ§æ—¥å¿—**ï¼šæ”¶é›†è¯·æ±‚çš„ç›‘æ§å’Œæ—¥å¿—ä¿¡æ¯
- **åè®®è½¬æ¢**ï¼šåœ¨ä¸åŒåè®®ä¹‹é—´è¿›è¡Œè½¬æ¢
- **æ•°æ®è½¬æ¢**ï¼šå¯¹è¯·æ±‚å’Œå“åº”æ•°æ®è¿›è¡Œè½¬æ¢
- **ç¼“å­˜**ï¼šå¯¹é¢‘ç¹è¯·æ±‚çš„å“åº”è¿›è¡Œç¼“å­˜
- **APIç»„åˆ**ï¼šå°†å¤šä¸ªAPIçš„å“åº”ç»„åˆæˆä¸€ä¸ªå“åº”
- **å®‰å…¨é˜²æŠ¤**ï¼šé˜²æ­¢å¸¸è§çš„Webæ”»å‡»ï¼Œå¦‚SQLæ³¨å…¥ã€XSSç­‰

### 4.2 APIç½‘å…³çš„æ¶æ„è®¾è®¡

APIç½‘å…³çš„æ¶æ„è®¾è®¡åº”è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

#### 4.2.1 ç»„ä»¶è®¾è®¡

APIç½‘å…³é€šå¸¸ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼š

- **è¯·æ±‚å¤„ç†å™¨**ï¼šæ¥æ”¶å’Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚
- **è·¯ç”±ç®¡ç†å™¨**ï¼šç®¡ç†è¯·æ±‚è·¯ç”±è§„åˆ™
- **è¿‡æ»¤å™¨é“¾**ï¼šåŒ…å«å¤šä¸ªè¿‡æ»¤å™¨ï¼Œç”¨äºå®ç°å„ç§åŠŸèƒ½
- **æœåŠ¡å‘ç°å®¢æˆ·ç«¯**ï¼šä¸æœåŠ¡æ³¨å†Œä¸­å¿ƒäº¤äº’ï¼Œè·å–æœåŠ¡å®ä¾‹ä¿¡æ¯
- **è´Ÿè½½å‡è¡¡å™¨**ï¼šåœ¨å¤šä¸ªæœåŠ¡å®ä¾‹ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡
- **è®¤è¯æˆæƒç®¡ç†å™¨**ï¼šå¤„ç†è®¤è¯å’Œæˆæƒé€»è¾‘
- **é™æµç†”æ–­ç®¡ç†å™¨**ï¼šå¤„ç†é™æµå’Œç†”æ–­é€»è¾‘
- **ç›‘æ§æ—¥å¿—æ”¶é›†å™¨**ï¼šæ”¶é›†ç›‘æ§å’Œæ—¥å¿—ä¿¡æ¯
- **é…ç½®ç®¡ç†å™¨**ï¼šç®¡ç†ç½‘å…³çš„é…ç½®ä¿¡æ¯

#### 4.2.2 æµç¨‹å›¾

```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ APIç½‘å…³ â†’ è¯·æ±‚è§£æ â†’ è·¯ç”±åŒ¹é… â†’ å‰ç½®è¿‡æ»¤å™¨ â†’ æœåŠ¡è°ƒç”¨ â†’ åç½®è¿‡æ»¤å™¨ â†’ å“åº”å¤„ç† â†’ å®¢æˆ·ç«¯
    â†“             â†“           â†“           â†“              â†“           â†“              â†“           â†“
  ç›‘æ§æ—¥å¿—      é…ç½®ç®¡ç†     æœåŠ¡å‘ç°     è®¤è¯æˆæƒ     é™æµç†”æ–­     è´Ÿè½½å‡è¡¡      æ•°æ®è½¬æ¢     ç¼“å­˜ç®¡ç†
```

#### 4.2.3 éƒ¨ç½²æ¨¡å¼

APIç½‘å…³çš„éƒ¨ç½²æ¨¡å¼åŒ…æ‹¬ï¼š

- **å•å®ä¾‹éƒ¨ç½²**ï¼šç®€å•ä½†ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
- **é›†ç¾¤éƒ¨ç½²**ï¼šå¤šå®ä¾‹éƒ¨ç½²ï¼Œæé«˜å¯ç”¨æ€§å’Œæ€§èƒ½
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¾¿äºç®¡ç†å’Œæ‰©å±•
- **äº‘åŸç”Ÿéƒ¨ç½²**ï¼šåœ¨Kubernetesç­‰äº‘åŸç”Ÿå¹³å°ä¸Šéƒ¨ç½²ï¼Œå……åˆ†åˆ©ç”¨äº‘åŸç”Ÿç‰¹æ€§

### 4.3 APIç½‘å…³çš„å®ç°æ–¹æ¡ˆ

å¸¸è§çš„APIç½‘å…³å®ç°æ–¹æ¡ˆåŒ…æ‹¬ï¼š

#### 4.3.1 å¼€æºAPIç½‘å…³

- **Spring Cloud Gateway**ï¼šSpring Cloudæä¾›çš„APIç½‘å…³ï¼ŒåŸºäºSpring Bootå’ŒSpring WebFlux
- **Netflix Zuul**ï¼šNetflixå¼€æºçš„APIç½‘å…³ï¼ŒåŸºäºJava
- **Kong**ï¼šåŸºäºNginxçš„å¼€æºAPIç½‘å…³ï¼Œæ”¯æŒæ’ä»¶æ‰©å±•
- **Traefik**ï¼šå¼€æºçš„äº‘åŸç”Ÿåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å·¥å…·
- **APISIX**ï¼šåŸºäºNginxå’ŒLuaçš„å¼€æºAPIç½‘å…³

#### 4.3.2 å•†ä¸šAPIç½‘å…³

- **Apigee**ï¼šGoogleæä¾›çš„APIç®¡ç†å¹³å°
- **MuleSoft Anypoint Platform**ï¼šMuleSoftæä¾›çš„é›†æˆå¹³å°
- **Tyk**ï¼šå¼€æºçš„APIç®¡ç†å¹³å°ï¼Œä¹Ÿæä¾›å•†ä¸šç‰ˆæœ¬
- **AWS API Gateway**ï¼šAWSæä¾›çš„APIç®¡ç†æœåŠ¡
- **Azure API Management**ï¼šAzureæä¾›çš„APIç®¡ç†æœåŠ¡

### 4.4 APIç½‘å…³çš„æœ€ä½³å®è·µ

- **åˆç†è®¾è®¡è·¯ç”±è§„åˆ™**ï¼šä½¿ç”¨æ¸…æ™°çš„è·¯ç”±è§„åˆ™ï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤
- **å®æ–½ç»†ç²’åº¦çš„è®¤è¯æˆæƒ**ï¼šæ ¹æ®APIçš„é‡è¦æ€§å’Œæ•æ„Ÿç¨‹åº¦ï¼Œå®æ–½ç»†ç²’åº¦çš„è®¤è¯æˆæƒ
- **é…ç½®åˆç†çš„é™æµç†”æ–­ç­–ç•¥**ï¼šæ ¹æ®æœåŠ¡çš„æ€§èƒ½å’Œå®¹é‡ï¼Œé…ç½®åˆç†çš„é™æµç†”æ–­ç­–ç•¥
- **å®æ–½ç›‘æ§å’Œå‘Šè­¦**ï¼šå¯¹APIç½‘å…³è¿›è¡Œç›‘æ§ï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜
- **ä¼˜åŒ–æ€§èƒ½**ï¼šå¯¹APIç½‘å…³è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œæé«˜å“åº”é€Ÿåº¦å’Œååé‡
- **å®æ–½ç¼“å­˜ç­–ç•¥**ï¼šå¯¹é¢‘ç¹è¯·æ±‚çš„å“åº”è¿›è¡Œç¼“å­˜ï¼Œå‡è½»åç«¯æœåŠ¡çš„å‹åŠ›
- **å®šæœŸæ›´æ–°å’Œç»´æŠ¤**ï¼šå®šæœŸæ›´æ–°APIç½‘å…³çš„ç‰ˆæœ¬ï¼Œä¿®å¤å®‰å…¨æ¼æ´å’Œbug
- **è€ƒè™‘é«˜å¯ç”¨æ€§**ï¼šè®¾è®¡é«˜å¯ç”¨çš„APIç½‘å…³æ¶æ„ï¼Œé¿å…å•ç‚¹æ•…éšœ

## äº”ã€APIæ–‡æ¡£å’Œæµ‹è¯•

### 5.1 APIæ–‡æ¡£

APIæ–‡æ¡£æ˜¯APIè®¾è®¡çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…ç†è§£å’Œä½¿ç”¨APIã€‚

#### 5.1.1 APIæ–‡æ¡£çš„é‡è¦æ€§

- **æé«˜å¼€å‘æ•ˆç‡**ï¼šæ¸…æ™°çš„æ–‡æ¡£å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£å’Œä½¿ç”¨API
- **å‡å°‘æ²Ÿé€šæˆæœ¬**ï¼šæ–‡æ¡£å¯ä»¥å‡å°‘å¼€å‘å›¢é˜Ÿä¹‹é—´çš„æ²Ÿé€šæˆæœ¬
- **ä¿ƒè¿›APIå¤ç”¨**ï¼šè‰¯å¥½çš„æ–‡æ¡£å¯ä»¥ä¿ƒè¿›APIçš„å¤ç”¨
- **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šå¯¹äºå¤–éƒ¨APIï¼Œè‰¯å¥½çš„æ–‡æ¡£å¯ä»¥æå‡å¼€å‘è€…çš„ä½¿ç”¨ä½“éªŒ
- **ä¾¿äºç»´æŠ¤**ï¼šæ–‡æ¡£å¯ä»¥å¸®åŠ©ç»´æŠ¤å›¢é˜Ÿç†è§£APIçš„è®¾è®¡æ„å›¾å’Œå®ç°ç»†èŠ‚

#### 5.1.2 APIæ–‡æ¡£å·¥å…·

å¸¸è§çš„APIæ–‡æ¡£å·¥å…·åŒ…æ‹¬ï¼š

- **Swagger/OpenAPI**ï¼šæœ€æµè¡Œçš„APIæ–‡æ¡£å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨ç”Ÿæˆå’Œäº¤äº’å¼æ–‡æ¡£
- **Postman**ï¼šAPIæµ‹è¯•å·¥å…·ï¼Œä¹Ÿæ”¯æŒAPIæ–‡æ¡£ç”Ÿæˆå’Œåˆ†äº«
- **GraphQL Playground**ï¼šGraphQL APIçš„äº¤äº’å¼æ–‡æ¡£å’Œæµ‹è¯•å·¥å…·
- **RAML**ï¼šRESTful APIå»ºæ¨¡è¯­è¨€ï¼Œç”¨äºæè¿°API
- **Apiary**ï¼šAPIè®¾è®¡å’Œæ–‡æ¡£å¹³å°
- **ReadMe**ï¼šç°ä»£åŒ–çš„APIæ–‡æ¡£å¹³å°
- **Slate**ï¼šæ¼‚äº®çš„APIæ–‡æ¡£ç”Ÿæˆå·¥å…·
- **Docusaurus**ï¼šFacebookå¼€æºçš„æ–‡æ¡£ç½‘ç«™ç”Ÿæˆå·¥å…·

#### 5.1.3 OpenAPIæ–‡æ¡£ç¤ºä¾‹

```yaml
openapi: 3.0.3
info:
  title: Product API
  description: API for managing products
  version: 1.0.0
servers:
  - url: http://api.example.com/v1
paths:
  /products:
    get:
      summary: Get all products
      description: Retrieve a list of products
      parameters:
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
        - name: size
          in: query
          description: Number of items per page
          schema:
            type: integer
            default: 10
        - name: sort
          in: query
          description: Sort field and direction, e.g. 'price,desc'
          schema:
            type: string
            default: 'createdAt,asc'
        - name: category
          in: query
          description: Filter by category
          schema:
            type: string
        - name: price_lte
          in: query
          description: Maximum price
          schema:
            type: number
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Success
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
    post:
      summary: Create a new product
      description: Create a new product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequest'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 201
                  message:
                    type: string
                    example: Product created successfully
                  data:
                    $ref: '#/components/schemas/Product'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /products/{id}:
    get:
      summary: Get product by ID
      description: Retrieve a product by its ID
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Success
                  data:
                    $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    put:
      summary: Update product
      description: Update an existing product
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductRequest'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Product updated successfully
                  data:
                    $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Delete product
      description: Delete a product by its ID
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
      responses:
        '200':
          description: Product deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: Product deleted successfully
                  data:
                    type: boolean
                    example: true
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
components:
  schemas:
    Product:
      type: object
      properties:
        id:
          type: string
          example: '123'
        name:
          type: string
          example: 'Smartphone'
        description:
          type: string
          example: 'Latest model smartphone with advanced features'
        price:
          type: number
          example: 599.99
        category:
          type: string
          example: 'electronics'
        createdAt:
          type: string
          format: date-time
          example: '2023-01-01T12:00:00Z'
        updatedAt:
          type: string
          format: date-time
          example: '2023-01-01T12:00:00Z'
    CreateProductRequest:
      type: object
      required:
        - name
        - price
        - category
      properties:
        name:
          type: string
          example: 'Smartphone'
        description:
          type: string
          example: 'Latest model smartphone with advanced features'
        price:
          type: number
          example: 599.99
        category:
          type: string
          example: 'electronics'
    UpdateProductRequest:
      type: object
      properties:
        name:
          type: string
          example: 'Smartphone'
        description:
          type: string
          example: 'Latest model smartphone with advanced features'
        price:
          type: number
          example: 599.99
        category:
          type: string
          example: 'electronics'
    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
          example: 400
        message:
          type: string
          example: 'Bad request'
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: 'name'
              message:
                type: string
                example: 'Name is required'
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
security:
  - bearerAuth: []
```

### 5.2 APIæµ‹è¯•

APIæµ‹è¯•æ˜¯ç¡®ä¿APIè´¨é‡å’Œç¨³å®šæ€§çš„é‡è¦æ‰‹æ®µï¼Œå¸¸è§çš„APIæµ‹è¯•ç±»å‹åŒ…æ‹¬ï¼š

#### 5.2.1 å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•ç”¨äºæµ‹è¯•APIçš„æœ€å°åŠŸèƒ½å•å…ƒï¼Œå¦‚å•ä¸ªå‡½æ•°æˆ–æ–¹æ³•ã€‚

**ç¤ºä¾‹ï¼ˆJava + JUnitï¼‰**ï¼š

```java
@ExtendWith(MockitoExtension.class)
public class ProductServiceTest {
    @Mock
    private ProductRepository productRepository;
    
    @InjectMocks
    private ProductService productService;
    
    @Test
    public void shouldGetProductById() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        Long productId = 1L;
        Product product = new Product();
        product.setId(productId);
        product.setName("Smartphone");
        product.setPrice(599.99);
        
        // é…ç½®Mockè¡Œä¸º
        when(productRepository.findById(productId)).thenReturn(Optional.of(product));
        
        // æ‰§è¡Œæµ‹è¯•
        Product result = productService.findById(productId);
        
        // éªŒè¯ç»“æœ
        assertNotNull(result);
        assertEquals(productId, result.getId());
        assertEquals("Smartphone", result.getName());
        assertEquals(599.99, result.getPrice(), 0.01);
        
        // éªŒè¯Mockè°ƒç”¨
        verify(productRepository, times(1)).findById(productId);
    }
    
    @Test
    public void shouldThrowExceptionWhenProductNotFound() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        Long productId = 1L;
        
        // é…ç½®Mockè¡Œä¸º
        when(productRepository.findById(productId)).thenReturn(Optional.empty());
        
        // æ‰§è¡Œæµ‹è¯•å¹¶éªŒè¯å¼‚å¸¸
        assertThrows(ProductNotFoundException.class, () -> {
            productService.findById(productId);
        });
        
        // éªŒè¯Mockè°ƒç”¨
        verify(productRepository, times(1)).findById(productId);
    }
    
    @Test
    public void shouldCreateProduct() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        CreateProductRequest request = new CreateProductRequest();
        request.setName("Smartphone");
        request.setDescription("Latest model smartphone");
        request.setPrice(599.99);
        request.setCategory("electronics");
        
        Product product = new Product();
        product.setId(1L);
        product.setName(request.getName());
        product.setDescription(request.getDescription());
        product.setPrice(request.getPrice());
        product.setCategory(request.getCategory());
        product.setCreatedAt(LocalDateTime.now());
        product.setUpdatedAt(LocalDateTime.now());
        
        // é…ç½®Mockè¡Œä¸º
        when(productRepository.save(any(Product.class))).thenReturn(product);
        
        // æ‰§è¡Œæµ‹è¯•
        Product result = productService.createProduct(request);
        
        // éªŒè¯ç»“æœ
        assertNotNull(result);
        assertEquals(1L, result.getId().longValue());
        assertEquals(request.getName(), result.getName());
        assertEquals(request.getPrice(), result.getPrice(), 0.01);
        
        // éªŒè¯Mockè°ƒç”¨
        verify(productRepository, times(1)).save(any(Product.class));
    }
}
```

#### 5.2.2 é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•ç”¨äºæµ‹è¯•APIçš„å„ä¸ªç»„ä»¶ä¹‹é—´çš„äº¤äº’ã€‚

**ç¤ºä¾‹ï¼ˆSpring Boot Testï¼‰**ï¼š

```java
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.MediaType;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;
import com.fasterxml.jackson.databind.ObjectMapper;
import static org.junit.jupiter.api.Assertions.assertEquals;
import java.time.LocalDateTime;
import java.util.List;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
public class ProductControllerIT {
    @Autowired
    private MockMvc mockMvc;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    @Autowired
    private ProductRepository productRepository;
    
    @BeforeEach
    public void setUp() {
        // æ¸…ç©ºæ•°æ®åº“
        productRepository.deleteAll();
        
        // åˆå§‹åŒ–æµ‹è¯•æ•°æ®
        Product product = new Product();
        product.setName("Smartphone");
        product.setDescription("Latest model smartphone");
        product.setPrice(599.99);
        product.setCategory("electronics");
        product.setCreatedAt(LocalDateTime.now());
        product.setUpdatedAt(LocalDateTime.now());
        productRepository.save(product);
    }
    
    @Test
    public void shouldGetAllProducts() throws Exception {
        // æ‰§è¡Œè¯·æ±‚
        mockMvc.perform(MockMvcRequestBuilders.get("/api/products")
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(MockMvcResultMatchers.status().isOk())
                .andExpect(MockMvcResultMatchers.jsonPath("$.length()").value(1))
                .andExpect(MockMvcResultMatchers.jsonPath("$[0].name").value("Smartphone"))
                .andExpect(MockMvcResultMatchers.jsonPath("$[0].price").value(599.99));
    }
    
    @Test
    public void shouldGetProductById() throws Exception {
        // è·å–å·²å­˜åœ¨çš„äº§å“ID
        Product existingProduct = productRepository.findAll().get(0);
        Long productId = existingProduct.getId();
        
        // æ‰§è¡Œè¯·æ±‚
        mockMvc.perform(MockMvcRequestBuilders.get("/api/products/{id}", productId)
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(MockMvcResultMatchers.status().isOk())
                .andExpect(MockMvcResultMatchers.jsonPath("$.id").value(productId))
                .andExpect(MockMvcResultMatchers.jsonPath("$.name").value("Smartphone"));
    }
    
    @Test
    public void shouldCreateProduct() throws Exception {
        // å‡†å¤‡è¯·æ±‚æ•°æ®
        CreateProductRequest request = new CreateProductRequest();
        request.setName("Laptop");
        request.setDescription("Gaming laptop");
        request.setPrice(1299.99);
        request.setCategory("electronics");
        
        // æ‰§è¡Œè¯·æ±‚
        mockMvc.perform(MockMvcRequestBuilders.post("/api/products")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
                .andExpect(MockMvcResultMatchers.status().isCreated())
                .andExpect(MockMvcResultMatchers.jsonPath("$.id").exists())
                .andExpect(MockMvcResultMatchers.jsonPath("$.name").value("Laptop"))
                .andExpect(MockMvcResultMatchers.jsonPath("$.price").value(1299.99));
        
        // éªŒè¯æ•°æ®åº“ä¸­æ˜¯å¦æ–°å¢äº†äº§å“
        List<Product> products = productRepository.findAll();
        assertEquals(2, products.size());
    }
    
    @Test
    public void shouldUpdateProduct() throws Exception {
        // è·å–å·²å­˜åœ¨çš„äº§å“ID
        Product existingProduct = productRepository.findAll().get(0);
        Long productId = existingProduct.getId();
        
        // å‡†å¤‡è¯·æ±‚æ•°æ®
        UpdateProductRequest request = new UpdateProductRequest();
        request.setName("Updated Smartphone");
        request.setPrice(649.99);
        
        // æ‰§è¡Œè¯·æ±‚
        mockMvc.perform(MockMvcRequestBuilders.put("/api/products/{id}", productId)
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
                .andExpect(MockMvcResultMatchers.status().isOk())
                .andExpect(MockMvcResultMatchers.jsonPath("$.id").value(productId))
                .andExpect(MockMvcResultMatchers.jsonPath("$.name").value("Updated Smartphone"))
                .andExpect(MockMvcResultMatchers.jsonPath("$.price").value(649.99));
    }
    
    @Test
    public void shouldDeleteProduct() throws Exception {
        // è·å–å·²å­˜åœ¨çš„äº§å“ID
        Product existingProduct = productRepository.findAll().get(0);
        Long productId = existingProduct.getId();
        
        // æ‰§è¡Œè¯·æ±‚
        mockMvc.perform(MockMvcRequestBuilders.delete("/api/products/{id}", productId)
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(MockMvcResultMatchers.status().isNoContent());
        
        // éªŒè¯æ•°æ®åº“ä¸­æ˜¯å¦åˆ é™¤äº†äº§å“
        List<Product> products = productRepository.findAll();
        assertEquals(0, products.size());
        
        // éªŒè¯åˆ é™¤åå†æŸ¥è¯¢ä¼šè¿”å›404
        mockMvc.perform(MockMvcRequestBuilders.get("/api/products/{id}", productId)
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(MockMvcResultMatchers.status().isNotFound());
    }
    
    @Test
    public void shouldReturnNotFoundWhenProductDoesNotExist() throws Exception {
        // ä½¿ç”¨ä¸å­˜åœ¨çš„äº§å“ID
        Long nonExistentId = 999L;
        
        // æ‰§è¡Œè¯·æ±‚
        mockMvc.perform(MockMvcRequestBuilders.get("/api/products/{id}", nonExistentId)
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(MockMvcResultMatchers.status().isNotFound());
    }
}
```

#### 5.2.3 å¥‘çº¦æµ‹è¯•

å¥‘çº¦æµ‹è¯•ç”¨äºç¡®ä¿APIæä¾›è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„å¥‘çº¦ä¸€è‡´æ€§ã€‚

**ç¤ºä¾‹ï¼ˆSpring Cloud Contractï¼‰**ï¼š

```groovy
// ç”Ÿäº§è€…å¥‘çº¦å®šä¹‰
Contract.make {
    description "should return product by id"
    request {
        method GET()
        urlPath("/api/products/1") {
            queryParameters {
            }
        }
        headers {
            contentType(applicationJson())
        }
    }
    response {
        status 200
        headers {
            contentType(applicationJson())
        }
        body("""
            {
                "id": 1,
                "name": "Smartphone",
                "description": "Latest model smartphone",
                "price": 599.99,
                "category": "electronics",
                "createdAt": $(regex("\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\.\\d{3}Z")),
                "updatedAt": $(regex("\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\.\\d{3}Z"))
            }
        """)
    }
}
```

#### 5.2.4 APIè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·

é™¤äº†ä»£ç çº§åˆ«çš„æµ‹è¯•å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸“ä¸šçš„APIè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·è¿›è¡Œæµ‹è¯•ï¼š

- **Postman**ï¼šåŠŸèƒ½å¼ºå¤§çš„APIå¼€å‘å’Œæµ‹è¯•å¹³å°ï¼Œæ”¯æŒåˆ›å»ºè‡ªåŠ¨åŒ–æµ‹è¯•é›†åˆ
- **SoapUI**ï¼šä¸“ä¸šçš„APIæµ‹è¯•å·¥å…·ï¼Œæ”¯æŒRESTå’ŒSOAP APIæµ‹è¯•
- **RestAssured**ï¼šJavaçš„REST APIæµ‹è¯•æ¡†æ¶ï¼Œæä¾›æµç•…çš„APIè¿›è¡Œæµ‹è¯•
- **Karate**ï¼šåŸºäºCucumberçš„APIæµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒBDDé£æ ¼çš„æµ‹è¯•
- **Insomnia**ï¼šè½»é‡çº§çš„APIæµ‹è¯•å·¥å…·ï¼Œç•Œé¢ç®€æ´æ˜“ç”¨

## å…­ã€æ€»ç»“

APIè®¾è®¡æ˜¯æ„å»ºç°ä»£è½¯ä»¶ç³»ç»Ÿçš„å…³é”®ç¯èŠ‚ï¼Œè‰¯å¥½çš„APIè®¾è®¡å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œç”¨æˆ·ä½“éªŒã€‚æœ¬æ–‡ä»‹ç»äº†APIè®¾è®¡çš„æ ¸å¿ƒåŸåˆ™ã€RESTful APIè®¾è®¡ã€GraphQL APIè®¾è®¡ã€APIç½‘å…³è®¾è®¡ã€APIæ–‡æ¡£ä¸æµ‹è¯•ç­‰æ–¹é¢çš„å†…å®¹ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…è®¾è®¡é«˜è´¨é‡çš„APIã€‚

APIè®¾è®¡æ˜¯ä¸€ä¸ªæŒç»­æ¼”è¿›çš„è¿‡ç¨‹ï¼Œéšç€ä¸šåŠ¡éœ€æ±‚çš„å˜åŒ–å’ŒæŠ€æœ¯çš„å‘å±•ï¼ŒAPIä¹Ÿéœ€è¦ä¸æ–­ä¼˜åŒ–å’Œæ›´æ–°ã€‚åœ¨APIè®¾è®¡å’Œæ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œåº”å§‹ç»ˆéµå¾ªAPIè®¾è®¡çš„æ ¸å¿ƒåŸåˆ™ï¼Œä¿æŒAPIçš„ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œå®‰å…¨æ€§ï¼ŒåŒæ—¶æ³¨é‡APIçš„æ–‡æ¡£åŒ–å’Œæµ‹è¯•ï¼Œç¡®ä¿APIçš„è´¨é‡å’Œç¨³å®šæ€§ã€‚

é€šè¿‡åˆç†çš„APIè®¾è®¡ï¼Œå¯ä»¥æ„å»ºå‡ºæ›´åŠ çµæ´»ã€å¯é å’Œé«˜æ•ˆçš„è½¯ä»¶ç³»ç»Ÿï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„æœåŠ¡å’Œä½“éªŒã€‚